<!doctype html><html lang=zh-cn><head><meta http-equiv=x-clacks-overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://sdttttt.github.io/favicon.ico><title>Kratos åˆå§‹åŒ–æµç¨‹æºç è§£æ | SDTTTTT's Smelly fish Rotten shrimp ğŸ““</title><meta name=title content="Kratos åˆå§‹åŒ–æµç¨‹æºç è§£æ"><meta name=description content="Kratos æ˜¯bilibiliå¼€æºçš„ä¸€å¥—Goå¾®æœåŠ¡æ¡†æ¶ï¼ŒåŒ…å«å¤§é‡å¾®æœåŠ¡ç›¸å…³æ¡†æ¶åŠå·¥å…·ã€‚
 åå­—æ¥æºäº:ã€Šæˆ˜ç¥ã€‹æ¸¸æˆä»¥å¸Œè…Šç¥è¯ä¸ºèƒŒæ™¯ï¼Œè®²è¿°ç”±å‡¡äººæˆä¸ºæˆ˜ç¥çš„å¥æ‰˜æ–¯ï¼ˆKratosï¼‰æˆä¸ºæˆ˜ç¥å¹¶å±•å¼€å¼‘ç¥å± æ€çš„å†’é™©å†ç¨‹ã€‚
 å¥½ï¼å¼€å§‹å§ï¼
å°æç¤ºï¼šé˜…è¯»æºç æ—¶è¯·ä¿æŒæ¸…é†’ã€‚
é¦–å…ˆæ˜¯æŒ‰ç…§Kratos tool ç”Ÿäº§çš„å·¥ç¨‹ç›®å½•ã€‚
â”œâ”€â”€ CHANGELOG.md â”œâ”€â”€ OWNERSâ”œâ”€â”€ README.mdâ”œâ”€â”€ api # apiç›®å½•ä¸ºå¯¹å¤–ä¿ç•™çš„protoæ–‡ä»¶åŠç”Ÿæˆçš„pb.goæ–‡ä»¶â”‚ â”œâ”€â”€ api.bm.goâ”‚ â”œâ”€â”€ api.pb.go # é€šè¿‡go generateç”Ÿæˆçš„pb.goæ–‡ä»¶â”‚ â”œâ”€â”€ api.protoâ”‚ â””â”€â”€ client.goâ”œâ”€â”€ cmdâ”‚ â””â”€â”€ main.go # cmdç›®å½•ä¸ºmainæ‰€åœ¨â”œâ”€â”€ configs # configsä¸ºé…ç½®æ–‡ä»¶ç›®å½•â”‚ â”œâ”€â”€ application.toml # åº”ç”¨çš„è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼Œå¯èƒ½æ˜¯ä¸€äº›ä¸šåŠ¡å¼€å…³å¦‚ï¼šuseABtest = trueâ”‚ â”œâ”€â”€ db.toml # dbç›¸å…³é…ç½®â”‚ â”œâ”€â”€ grpc.toml # grpcç›¸å…³é…ç½®â”‚ â”œâ”€â”€ http.toml # httpç›¸å…³é…ç½®â”‚ â”œâ”€â”€ memcache."><meta name=keywords content="microservice,Source code analysis,"><meta property="og:title" content="Kratos åˆå§‹åŒ–æµç¨‹æºç è§£æ"><meta property="og:description" content="Kratos æ˜¯bilibiliå¼€æºçš„ä¸€å¥—Goå¾®æœåŠ¡æ¡†æ¶ï¼ŒåŒ…å«å¤§é‡å¾®æœåŠ¡ç›¸å…³æ¡†æ¶åŠå·¥å…·ã€‚
 åå­—æ¥æºäº:ã€Šæˆ˜ç¥ã€‹æ¸¸æˆä»¥å¸Œè…Šç¥è¯ä¸ºèƒŒæ™¯ï¼Œè®²è¿°ç”±å‡¡äººæˆä¸ºæˆ˜ç¥çš„å¥æ‰˜æ–¯ï¼ˆKratosï¼‰æˆä¸ºæˆ˜ç¥å¹¶å±•å¼€å¼‘ç¥å± æ€çš„å†’é™©å†ç¨‹ã€‚
 å¥½ï¼å¼€å§‹å§ï¼
å°æç¤ºï¼šé˜…è¯»æºç æ—¶è¯·ä¿æŒæ¸…é†’ã€‚
é¦–å…ˆæ˜¯æŒ‰ç…§Kratos tool ç”Ÿäº§çš„å·¥ç¨‹ç›®å½•ã€‚
â”œâ”€â”€ CHANGELOG.md â”œâ”€â”€ OWNERSâ”œâ”€â”€ README.mdâ”œâ”€â”€ api # apiç›®å½•ä¸ºå¯¹å¤–ä¿ç•™çš„protoæ–‡ä»¶åŠç”Ÿæˆçš„pb.goæ–‡ä»¶â”‚ â”œâ”€â”€ api.bm.goâ”‚ â”œâ”€â”€ api.pb.go # é€šè¿‡go generateç”Ÿæˆçš„pb.goæ–‡ä»¶â”‚ â”œâ”€â”€ api.protoâ”‚ â””â”€â”€ client.goâ”œâ”€â”€ cmdâ”‚ â””â”€â”€ main.go # cmdç›®å½•ä¸ºmainæ‰€åœ¨â”œâ”€â”€ configs # configsä¸ºé…ç½®æ–‡ä»¶ç›®å½•â”‚ â”œâ”€â”€ application.toml # åº”ç”¨çš„è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼Œå¯èƒ½æ˜¯ä¸€äº›ä¸šåŠ¡å¼€å…³å¦‚ï¼šuseABtest = trueâ”‚ â”œâ”€â”€ db.toml # dbç›¸å…³é…ç½®â”‚ â”œâ”€â”€ grpc.toml # grpcç›¸å…³é…ç½®â”‚ â”œâ”€â”€ http.toml # httpç›¸å…³é…ç½®â”‚ â”œâ”€â”€ memcache."><meta property="og:type" content="article"><meta property="og:url" content="https://sdttttt.github.io/blog/kratos/"><meta property="og:image" content="https://sdttttt.github.io/static/me.jpg"><meta property="article:published_time" content="2020-03-31T20:17:28+08:00"><meta property="article:modified_time" content="2020-09-24T18:06:32+08:00"><meta property="og:site_name" content="SDTTTTT"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://sdttttt.github.io/static/me.jpg"><meta name=twitter:title content="Kratos åˆå§‹åŒ–æµç¨‹æºç è§£æ"><meta name=twitter:description content="Kratos æ˜¯bilibiliå¼€æºçš„ä¸€å¥—Goå¾®æœåŠ¡æ¡†æ¶ï¼ŒåŒ…å«å¤§é‡å¾®æœåŠ¡ç›¸å…³æ¡†æ¶åŠå·¥å…·ã€‚
 åå­—æ¥æºäº:ã€Šæˆ˜ç¥ã€‹æ¸¸æˆä»¥å¸Œè…Šç¥è¯ä¸ºèƒŒæ™¯ï¼Œè®²è¿°ç”±å‡¡äººæˆä¸ºæˆ˜ç¥çš„å¥æ‰˜æ–¯ï¼ˆKratosï¼‰æˆä¸ºæˆ˜ç¥å¹¶å±•å¼€å¼‘ç¥å± æ€çš„å†’é™©å†ç¨‹ã€‚
 å¥½ï¼å¼€å§‹å§ï¼
å°æç¤ºï¼šé˜…è¯»æºç æ—¶è¯·ä¿æŒæ¸…é†’ã€‚
é¦–å…ˆæ˜¯æŒ‰ç…§Kratos tool ç”Ÿäº§çš„å·¥ç¨‹ç›®å½•ã€‚
â”œâ”€â”€ CHANGELOG.md â”œâ”€â”€ OWNERSâ”œâ”€â”€ README.mdâ”œâ”€â”€ api # apiç›®å½•ä¸ºå¯¹å¤–ä¿ç•™çš„protoæ–‡ä»¶åŠç”Ÿæˆçš„pb.goæ–‡ä»¶â”‚ â”œâ”€â”€ api.bm.goâ”‚ â”œâ”€â”€ api.pb.go # é€šè¿‡go generateç”Ÿæˆçš„pb.goæ–‡ä»¶â”‚ â”œâ”€â”€ api.protoâ”‚ â””â”€â”€ client.goâ”œâ”€â”€ cmdâ”‚ â””â”€â”€ main.go # cmdç›®å½•ä¸ºmainæ‰€åœ¨â”œâ”€â”€ configs # configsä¸ºé…ç½®æ–‡ä»¶ç›®å½•â”‚ â”œâ”€â”€ application.toml # åº”ç”¨çš„è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼Œå¯èƒ½æ˜¯ä¸€äº›ä¸šåŠ¡å¼€å…³å¦‚ï¼šuseABtest = trueâ”‚ â”œâ”€â”€ db.toml # dbç›¸å…³é…ç½®â”‚ â”œâ”€â”€ grpc.toml # grpcç›¸å…³é…ç½®â”‚ â”œâ”€â”€ http.toml # httpç›¸å…³é…ç½®â”‚ â”œâ”€â”€ memcache."><meta itemprop=name content="Kratos åˆå§‹åŒ–æµç¨‹æºç è§£æ"><meta itemprop=description content="Kratos æ˜¯bilibiliå¼€æºçš„ä¸€å¥—Goå¾®æœåŠ¡æ¡†æ¶ï¼ŒåŒ…å«å¤§é‡å¾®æœåŠ¡ç›¸å…³æ¡†æ¶åŠå·¥å…·ã€‚
 åå­—æ¥æºäº:ã€Šæˆ˜ç¥ã€‹æ¸¸æˆä»¥å¸Œè…Šç¥è¯ä¸ºèƒŒæ™¯ï¼Œè®²è¿°ç”±å‡¡äººæˆä¸ºæˆ˜ç¥çš„å¥æ‰˜æ–¯ï¼ˆKratosï¼‰æˆä¸ºæˆ˜ç¥å¹¶å±•å¼€å¼‘ç¥å± æ€çš„å†’é™©å†ç¨‹ã€‚
 å¥½ï¼å¼€å§‹å§ï¼
å°æç¤ºï¼šé˜…è¯»æºç æ—¶è¯·ä¿æŒæ¸…é†’ã€‚
é¦–å…ˆæ˜¯æŒ‰ç…§Kratos tool ç”Ÿäº§çš„å·¥ç¨‹ç›®å½•ã€‚
â”œâ”€â”€ CHANGELOG.md â”œâ”€â”€ OWNERSâ”œâ”€â”€ README.mdâ”œâ”€â”€ api # apiç›®å½•ä¸ºå¯¹å¤–ä¿ç•™çš„protoæ–‡ä»¶åŠç”Ÿæˆçš„pb.goæ–‡ä»¶â”‚ â”œâ”€â”€ api.bm.goâ”‚ â”œâ”€â”€ api.pb.go # é€šè¿‡go generateç”Ÿæˆçš„pb.goæ–‡ä»¶â”‚ â”œâ”€â”€ api.protoâ”‚ â””â”€â”€ client.goâ”œâ”€â”€ cmdâ”‚ â””â”€â”€ main.go # cmdç›®å½•ä¸ºmainæ‰€åœ¨â”œâ”€â”€ configs # configsä¸ºé…ç½®æ–‡ä»¶ç›®å½•â”‚ â”œâ”€â”€ application.toml # åº”ç”¨çš„è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼Œå¯èƒ½æ˜¯ä¸€äº›ä¸šåŠ¡å¼€å…³å¦‚ï¼šuseABtest = trueâ”‚ â”œâ”€â”€ db.toml # dbç›¸å…³é…ç½®â”‚ â”œâ”€â”€ grpc.toml # grpcç›¸å…³é…ç½®â”‚ â”œâ”€â”€ http.toml # httpç›¸å…³é…ç½®â”‚ â”œâ”€â”€ memcache."><meta itemprop=datePublished content="2020-03-31T20:17:28+08:00"><meta itemprop=dateModified content="2020-09-24T18:06:32+08:00"><meta itemprop=wordCount content="1105"><meta itemprop=image content="https://sdttttt.github.io/static/me.jpg"><meta itemprop=keywords content="microservice,Source code analysis,"><meta name=referrer content="no-referrer-when-downgrade"><style>body{font-family:Verdana,sans-serif;margin:auto;padding:20px;max-width:720px;text-align:left;background-color:#fff;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444}h1,h2,h3,h4,h5,h6,strong,b{color:#222}a{color:#3273dc}.title{text-decoration:none;border:0}.title span{font-weight:400}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}pre code{color:#222;display:block;padding:20px;white-space:pre-wrap;font-size:14px}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}footer{padding:25px;text-align:center}.helptext{color:#777;font-size:small}.errorlist{color:#eba613;font-size:small}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}@media(prefers-color-scheme:dark){body{background-color:#333;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#777}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}.helptext{color:#aaa}}</style></head><body><header><a href=/ class=title><h2>SDTTTTT's Smelly fish Rotten shrimp ğŸ““</h2></a><nav><a href=/>Home</a>
<a href=/blog>Blog</a></nav></header><main><h1>Kratos åˆå§‹åŒ–æµç¨‹æºç è§£æ</h1><p><i><time datetime=2020-03-31 pubdate>31 Mar, 2020</time></i></p><content><p><strong>Kratos</strong> æ˜¯bilibiliå¼€æºçš„ä¸€å¥—Goå¾®æœåŠ¡æ¡†æ¶ï¼ŒåŒ…å«å¤§é‡å¾®æœåŠ¡ç›¸å…³æ¡†æ¶åŠå·¥å…·ã€‚</p><blockquote><p>åå­—æ¥æºäº:ã€Šæˆ˜ç¥ã€‹æ¸¸æˆä»¥å¸Œè…Šç¥è¯ä¸ºèƒŒæ™¯ï¼Œè®²è¿°ç”±å‡¡äººæˆä¸ºæˆ˜ç¥çš„å¥æ‰˜æ–¯ï¼ˆKratosï¼‰æˆä¸ºæˆ˜ç¥å¹¶å±•å¼€å¼‘ç¥å± æ€çš„å†’é™©å†ç¨‹ã€‚</p></blockquote><p>å¥½ï¼å¼€å§‹å§ï¼</p><p><em>å°æç¤ºï¼šé˜…è¯»æºç æ—¶è¯·ä¿æŒæ¸…é†’ã€‚</em></p><p>é¦–å…ˆæ˜¯æŒ‰ç…§Kratos tool ç”Ÿäº§çš„å·¥ç¨‹ç›®å½•ã€‚</p><pre><code>â”œâ”€â”€ CHANGELOG.md 
â”œâ”€â”€ OWNERS
â”œâ”€â”€ README.md
â”œâ”€â”€ api                     # apiç›®å½•ä¸ºå¯¹å¤–ä¿ç•™çš„protoæ–‡ä»¶åŠç”Ÿæˆçš„pb.goæ–‡ä»¶
â”‚   â”œâ”€â”€ api.bm.go
â”‚   â”œâ”€â”€ api.pb.go           # é€šè¿‡go generateç”Ÿæˆçš„pb.goæ–‡ä»¶
â”‚   â”œâ”€â”€ api.proto
â”‚   â””â”€â”€ client.go
â”œâ”€â”€ cmd
â”‚   â””â”€â”€ main.go             # cmdç›®å½•ä¸ºmainæ‰€åœ¨
â”œâ”€â”€ configs                 # configsä¸ºé…ç½®æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ application.toml    # åº”ç”¨çš„è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼Œå¯èƒ½æ˜¯ä¸€äº›ä¸šåŠ¡å¼€å…³å¦‚ï¼šuseABtest = true
â”‚   â”œâ”€â”€ db.toml             # dbç›¸å…³é…ç½®
â”‚   â”œâ”€â”€ grpc.toml           # grpcç›¸å…³é…ç½®
â”‚   â”œâ”€â”€ http.toml           # httpç›¸å…³é…ç½®
â”‚   â”œâ”€â”€ memcache.toml       # memcacheç›¸å…³é…ç½®
â”‚   â””â”€â”€ redis.toml          # redisç›¸å…³é…ç½®
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â””â”€â”€ internal                # internalä¸ºé¡¹ç›®å†…éƒ¨åŒ…ï¼ŒåŒ…æ‹¬ä»¥ä¸‹ç›®å½•ï¼š
â”‚   â”œâ”€â”€ dao                 # daoå±‚ï¼Œç”¨äºæ•°æ®åº“ã€cacheã€MQã€ä¾èµ–æŸä¸šåŠ¡grpc|httpç­‰èµ„æºè®¿é—®
â”‚   â”‚   â”œâ”€â”€ dao.bts.go
â”‚   â”‚   â”œâ”€â”€ dao.go
â”‚   â”‚   â”œâ”€â”€ db.go
â”‚   â”‚   â”œâ”€â”€ mc.cache.go
â”‚   â”‚   â”œâ”€â”€ mc.go
â”‚   â”‚   â””â”€â”€ redis.go
â”‚   â”œâ”€â”€ di                  # ä¾èµ–æ³¨å…¥å±‚ é‡‡ç”¨wireé™æ€åˆ†æä¾èµ–
â”‚   â”‚   â”œâ”€â”€ app.go
â”‚   â”‚   â”œâ”€â”€ wire.go         # wire å£°æ˜
â”‚   â”‚   â””â”€â”€ wire_gen.go     # go generate ç”Ÿæˆçš„ä»£ç 
â”‚   â”œâ”€â”€ model               # modelå±‚ï¼Œç”¨äºå£°æ˜ä¸šåŠ¡ç»“æ„ä½“
â”‚   â”‚   â””â”€â”€ model.go
â”‚   â”œâ”€â”€ server              # serverå±‚ï¼Œç”¨äºåˆå§‹åŒ–grpcå’Œhttp server
â”‚   â”‚   â”œâ”€â”€ grpc            # grpcå±‚ï¼Œç”¨äºåˆå§‹åŒ–grpc serverå’Œå®šä¹‰method
â”‚   â”‚   â”‚   â””â”€â”€ server.go
â”‚   â”‚   â””â”€â”€ http            # httpå±‚ï¼Œç”¨äºåˆå§‹åŒ–http serverå’Œå£°æ˜handler
â”‚   â”‚       â””â”€â”€ server.go
â”‚   â””â”€â”€ service             # serviceå±‚ï¼Œç”¨äºä¸šåŠ¡é€»è¾‘å¤„ç†ï¼Œä¸”ä¸ºæ–¹ä¾¿httpå’Œgrpcå…±ç”¨æ–¹æ³•ï¼Œå»ºè®®å…¥å‚å’Œå‡ºå‚ä¿æŒgrpcé£æ ¼ï¼Œä¸”ä½¿ç”¨pbæ–‡ä»¶ç”Ÿæˆä»£ç 
â”‚       â””â”€â”€ service.go
â””â”€â”€ test                    # æµ‹è¯•èµ„æºå±‚ ç”¨äºå­˜æ”¾æµ‹è¯•ç›¸å…³èµ„æºæ•°æ® å¦‚docker-composeé…ç½® æ•°æ®åº“åˆå§‹åŒ–è¯­å¥ç­‰
    â””â”€â”€ docker-compose.yaml
</code></pre><h2 id=entry>Entry</h2><p>å…¥å£åœ¨<code>cmd/main.go</code>ä¸‹ï¼Œæˆ‘ä»¬è¿›å»çœ‹çœ‹ã€‚</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
    <span style=color:#75715e>// æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œå‚æ•°è§£æ
</span><span style=color:#75715e></span>	<span style=color:#a6e22e>flag</span>.<span style=color:#a6e22e>Parse</span>()
	<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Init</span>(<span style=color:#66d9ef>nil</span>) <span style=color:#75715e>// debug flag: log.dir={path}
</span><span style=color:#75715e></span>	<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Close</span>()
	<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Info</span>(<span style=color:#e6db74>&#34;kratos-demo start&#34;</span>)
	<span style=color:#75715e>// -conf å‚æ•°çš„è§£æ
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>paladin</span>.<span style=color:#a6e22e>Init</span>()
	<span style=color:#75715e>// è¿™é‡Œæ˜¯ `æ·±å‘çš„å…¥å£`
</span><span style=color:#75715e></span>	<span style=color:#75715e>// ä¸€ä¼šåˆ†æ
</span><span style=color:#75715e></span>	<span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>closeFunc</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>di</span>.<span style=color:#a6e22e>InitApp</span>()
	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
		panic(<span style=color:#a6e22e>err</span>)
    }
    <span style=color:#75715e>// os.Signal æ˜¯ä¸€ä¸ªç³»ç»Ÿä¿¡å·æ¥æ”¶channel
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>c</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Signal</span>, <span style=color:#ae81ff>1</span>)
    <span style=color:#75715e>// syscall éƒ½æ˜¯ä¸€äº›ç³»ç»Ÿä¿¡å·
</span><span style=color:#75715e></span>	<span style=color:#a6e22e>signal</span>.<span style=color:#a6e22e>Notify</span>(<span style=color:#a6e22e>c</span>, <span style=color:#a6e22e>syscall</span>.<span style=color:#a6e22e>SIGHUP</span>, <span style=color:#a6e22e>syscall</span>.<span style=color:#a6e22e>SIGQUIT</span>, <span style=color:#a6e22e>syscall</span>.<span style=color:#a6e22e>SIGTERM</span>, <span style=color:#a6e22e>syscall</span>.<span style=color:#a6e22e>SIGINT</span>)
	<span style=color:#66d9ef>for</span> {
        <span style=color:#75715e>// ä¸€æ—¦æœ‰ä¿¡å·è¿›æ¥äº†ï¼Œçœ‹ä¸‹é¢çš„ä»£ç é€»è¾‘ï¼Œå…«æˆæ˜¯å…³é—­è¿™ä¸ªåº”ç”¨ã€‚
</span><span style=color:#75715e></span>		<span style=color:#a6e22e>s</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>c</span>
		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Info</span>(<span style=color:#e6db74>&#34;get a signal %s&#34;</span>, <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>String</span>())
		<span style=color:#66d9ef>switch</span> <span style=color:#a6e22e>s</span> {
		<span style=color:#66d9ef>case</span> <span style=color:#a6e22e>syscall</span>.<span style=color:#a6e22e>SIGQUIT</span>, <span style=color:#a6e22e>syscall</span>.<span style=color:#a6e22e>SIGTERM</span>, <span style=color:#a6e22e>syscall</span>.<span style=color:#a6e22e>SIGINT</span>:
			<span style=color:#a6e22e>closeFunc</span>()
			<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Info</span>(<span style=color:#e6db74>&#34;kratos-demo exit&#34;</span>)
			<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>)
			<span style=color:#66d9ef>return</span>
		<span style=color:#66d9ef>case</span> <span style=color:#a6e22e>syscall</span>.<span style=color:#a6e22e>SIGHUP</span>:
		<span style=color:#66d9ef>default</span>:
			<span style=color:#66d9ef>return</span>
		}
	}
}

</code></pre></div><h2 id=initializer>Initializer</h2><p>æ¥ä¸‹æ¥æˆ‘ä»¬å»çœ‹<code>di.InitApp()</code>é‡Œåšäº†ä»€ä¹ˆã€‚</p><p>è¿™ä¸ªæ–¹æ³•æ˜¯é€šè¿‡<code>github.com/google/wire</code>æ¥ç”Ÿæˆ.</p><p>å¦‚æœä½ ä¸çŸ¥é“<code>wire</code>å¯ä»¥å‚è€ƒä¸‹é¢çš„å®˜æ–¹åŸè¯ï¼š</p><blockquote><p>Wire is a code generation tool that automates connecting components using dependency injection. Dependencies between components are represented in Wire as function parameters, encouraging explicit initialization instead of global variables. Because Wire operates without runtime state or reflection, code written to be used with Wire is useful even for hand-written initialization.</p></blockquote><blockquote><p>ç®€å•æ¥è¯´å°±æ˜¯Golangçš„ä¾èµ–æ³¨å…¥ä»£ç ç”Ÿæˆå™¨, å®ƒä¸ä½¿ç”¨åå°„.ç”±Googleæä¾›.</p></blockquote><p>ä¸è¿‡<code>Wire</code>ä¸æ˜¯æˆ‘ä»¬çš„é‡ç‚¹, æˆ‘ä»¬æ¥ç€å›åˆ°<code>di.InitApp()</code>å»ã€‚</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#75715e>// Injectors from wire.go:
</span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>InitApp</span>() (<span style=color:#f92672>*</span><span style=color:#a6e22e>App</span>, <span style=color:#66d9ef>func</span>(), <span style=color:#66d9ef>error</span>) {

    <span style=color:#75715e>// åŸºæœ¬ä¸Šå°±æ˜¯åˆ›å»ºä¸€ä¸ªä¸ªå®ä¾‹ï¼Œå’Œå–„åå®ƒä»¬çš„å‡½æ•°
</span><span style=color:#75715e></span>    <span style=color:#75715e>// å¦‚æœé€”ä¸­åˆ›å»ºå‡ºé—®é¢˜å°±å…¨ä½“ä¸‹è‘¬ï¼ˆè§¦å‘å–„åå‡½æ•°ï¼‰.
</span><span style=color:#75715e></span>
	<span style=color:#75715e>// Rediså®ä¾‹ï¼Œå–„åå‡½æ•°
</span><span style=color:#75715e></span>	<span style=color:#a6e22e>redis</span>, <span style=color:#a6e22e>cleanup</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>dao</span>.<span style=color:#a6e22e>NewRedis</span>()
	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
	}

	<span style=color:#75715e>// memcacheå®ä¾‹ï¼Œå–„åå‡½æ•°
</span><span style=color:#75715e></span>	<span style=color:#a6e22e>memcache</span>, <span style=color:#a6e22e>cleanup2</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>dao</span>.<span style=color:#a6e22e>NewMC</span>()
	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
		<span style=color:#a6e22e>cleanup</span>()
		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
	}

	<span style=color:#75715e>// çœ‹èµ·æ¥åªæ”¯æŒMySQLï¼Œå–„åå‡½æ•°
</span><span style=color:#75715e></span>	<span style=color:#a6e22e>db</span>, <span style=color:#a6e22e>cleanup3</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>dao</span>.<span style=color:#a6e22e>NewDB</span>()
	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
		<span style=color:#a6e22e>cleanup2</span>()
		<span style=color:#a6e22e>cleanup</span>()
		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
	}

	<span style=color:#75715e>// æŠŠä¸Šé¢æ‰€æœ‰çš„æ¨¡å‹å¯¹è±¡åšä¸€ä¸ªDAOå±‚å°è£…
</span><span style=color:#75715e></span>	<span style=color:#a6e22e>daoDao</span>, <span style=color:#a6e22e>cleanup4</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>dao</span>.<span style=color:#a6e22e>New</span>(<span style=color:#a6e22e>redis</span>, <span style=color:#a6e22e>memcache</span>, <span style=color:#a6e22e>db</span>)
	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
		<span style=color:#a6e22e>cleanup3</span>()
		<span style=color:#a6e22e>cleanup2</span>()
		<span style=color:#a6e22e>cleanup</span>()
		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
	}

    <span style=color:#75715e>// è¿™ä¸ªæ˜¯ä¸ªé‡ç‚¹ï¼Œ`service`æ˜¯ä½ çš„gRPCæœåŠ¡.
</span><span style=color:#75715e></span>	<span style=color:#75715e>// ä¸€ä¼šæˆ‘ä»¬å»åˆ†æä»–
</span><span style=color:#75715e></span>	<span style=color:#a6e22e>serviceService</span>, <span style=color:#a6e22e>cleanup5</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>service</span>.<span style=color:#a6e22e>New</span>(<span style=color:#a6e22e>daoDao</span>)
	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
		<span style=color:#a6e22e>cleanup4</span>()
		<span style=color:#a6e22e>cleanup3</span>()
		<span style=color:#a6e22e>cleanup2</span>()
		<span style=color:#a6e22e>cleanup</span>()
		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
	}

    <span style=color:#75715e>// æœ‰äººä¼šå¥½å¥‡Kratosæ˜¯æ€ä¹ˆæŠŠgRPCå’ŒGinèåˆåœ¨ä¸€èµ·çš„
</span><span style=color:#75715e></span>    <span style=color:#75715e>//ï¼ˆæ²¡é”™Bilibiliçš„webæ¡†æ¶æ˜¯Gin, ä¸è¿‡è¿™ä¸ªGinçš„ä¸€éƒ¨åˆ†æ ¸å¿ƒä»£ç å·²ç»è¢«é­”æ”¹è¿‡äº†ï¼Œ åœ¨Engineåˆå§‹åŒ–çš„æ—¶å€™ä¼šå¤šåŠ å…¥ä¸€ä¸ªé“¾è·¯è¿½è¸ªçš„Middleware, è¿˜æœ‰ä¸€å †è·¯ç”±...ï¼‰
</span><span style=color:#75715e></span>    <span style=color:#75715e>// ç§˜å¯†å°±åœ¨è¿™é‡Œï¼Œç­‰ä¼šæˆ‘ä»¬å†çœ‹
</span><span style=color:#75715e></span>	<span style=color:#a6e22e>engine</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>New</span>(<span style=color:#a6e22e>serviceService</span>)
	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
		<span style=color:#a6e22e>cleanup5</span>()
		<span style=color:#a6e22e>cleanup4</span>()
		<span style=color:#a6e22e>cleanup3</span>()
		<span style=color:#a6e22e>cleanup2</span>()
		<span style=color:#a6e22e>cleanup</span>()
		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
    }
    
    <span style=color:#75715e>// gRPCçš„åˆå§‹åŒ–çš„å¸¸è§„æ“ä½œ
</span><span style=color:#75715e></span>	<span style=color:#a6e22e>server</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>grpc</span>.<span style=color:#a6e22e>New</span>(<span style=color:#a6e22e>serviceService</span>)
	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
		<span style=color:#a6e22e>cleanup5</span>()
		<span style=color:#a6e22e>cleanup4</span>()
		<span style=color:#a6e22e>cleanup3</span>()
		<span style=color:#a6e22e>cleanup2</span>()
		<span style=color:#a6e22e>cleanup</span>()
		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
    }
    
    <span style=color:#75715e>// æŠŠä¸Šé¢çš„æœåŠ¡ï¼Œengine,gRPCæœåŠ¡,æ•´ä¸€å—
</span><span style=color:#75715e></span>	<span style=color:#75715e>// å–„åå‡½æ•°
</span><span style=color:#75715e></span>	<span style=color:#75715e>// åé¢ç¨å¾®åˆ†æä¸€ä¸‹
</span><span style=color:#75715e></span>	<span style=color:#a6e22e>app</span>, <span style=color:#a6e22e>cleanup6</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>NewApp</span>(<span style=color:#a6e22e>serviceService</span>, <span style=color:#a6e22e>engine</span>, <span style=color:#a6e22e>server</span>)
	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
		<span style=color:#a6e22e>cleanup5</span>()
		<span style=color:#a6e22e>cleanup4</span>()
		<span style=color:#a6e22e>cleanup3</span>()
		<span style=color:#a6e22e>cleanup2</span>()
		<span style=color:#a6e22e>cleanup</span>()
		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
    }
    
    <span style=color:#75715e>// ä½ å¯ä»¥èµ°äº†.
</span><span style=color:#75715e></span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>app</span>, <span style=color:#66d9ef>func</span>() {
		<span style=color:#a6e22e>cleanup6</span>()
		<span style=color:#a6e22e>cleanup5</span>()
		<span style=color:#a6e22e>cleanup4</span>()
		<span style=color:#a6e22e>cleanup3</span>()
		<span style=color:#a6e22e>cleanup2</span>()
		<span style=color:#a6e22e>cleanup</span>()
	}, <span style=color:#66d9ef>nil</span>
}

<span style=color:#75715e>//ä»¥ä¸Šä»£ç å…¨æ˜¯è‡ªåŠ¨ç”Ÿæˆï¼Œå†—ä½™å¾ˆæ­£å¸¸
</span></code></pre></div><p>æ¥ä¸‹æ¥æˆ‘ä»¬é¦–å…ˆçœ‹çœ‹<code>serviceService</code>æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿.<em>(è¿™æ˜¯ä»€ä¹ˆé­”é¬¼å‘½å)</em></p><p>è¿›åˆ°<code>Service.New(dao)</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go>
<span style=color:#75715e>// Service service.
</span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Service</span> <span style=color:#66d9ef>struct</span> {
    <span style=color:#75715e>// é…ç½®æ–‡ä»¶æ˜ å°„çš„Map (è¿™ä¸ªå‘½åå°±nmç¦»è°±)
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>ac</span>  <span style=color:#f92672>*</span><span style=color:#a6e22e>paladin</span>.<span style=color:#a6e22e>Map</span>
    <span style=color:#75715e>// å­—é¢æ„æ€
</span><span style=color:#75715e></span>	<span style=color:#a6e22e>dao</span> <span style=color:#a6e22e>dao</span>.<span style=color:#a6e22e>Dao</span>
}

<span style=color:#75715e>// New new a service and return.
</span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>New</span>(<span style=color:#a6e22e>d</span> <span style=color:#a6e22e>dao</span>.<span style=color:#a6e22e>Dao</span>) (<span style=color:#a6e22e>s</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Service</span>, <span style=color:#a6e22e>cf</span> <span style=color:#66d9ef>func</span>(), <span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>) {
    <span style=color:#75715e>// åˆå§‹åŒ–ï½ï½ï½
</span><span style=color:#75715e></span>	<span style=color:#a6e22e>s</span> = <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>Service</span>{
		<span style=color:#a6e22e>ac</span>:  <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>paladin</span>.<span style=color:#a6e22e>TOML</span>{},
		<span style=color:#a6e22e>dao</span>: <span style=color:#a6e22e>d</span>,
	}
    <span style=color:#75715e>// ä¸€ä¸ªå…³é—­çš„é’©å­
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>cf</span> = <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>Close</span>

	<span style=color:#75715e>// çƒ­åŠ è½½ application.toml é…ç½®æ–‡ä»¶
</span><span style=color:#75715e></span>	<span style=color:#75715e>// åŸç†æ˜¯ä½¿ç”¨fsnotifyç›‘å¬æ–‡ä»¶å˜æ›´
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>paladin</span>.<span style=color:#a6e22e>Watch</span>(<span style=color:#e6db74>&#34;application.toml&#34;</span>, <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>ac</span>)
	<span style=color:#66d9ef>return</span>
}

<span style=color:#75715e>// -------------- ä¸‹é¢éƒ½æ˜¯ä½ çš„gRPCä¸šåŠ¡é€»è¾‘-------------
</span><span style=color:#75715e></span>
<span style=color:#75715e>// SayHello grpc demo func.
</span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>s</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Service</span>) <span style=color:#a6e22e>SayHello</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>req</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>pb</span>.<span style=color:#a6e22e>HelloReq</span>) (<span style=color:#a6e22e>reply</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>empty</span>.<span style=color:#a6e22e>Empty</span>, <span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>) {
	<span style=color:#a6e22e>reply</span> = new(<span style=color:#a6e22e>empty</span>.<span style=color:#a6e22e>Empty</span>)
	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;hello %s&#34;</span>, <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>Name</span>)
	<span style=color:#66d9ef>return</span>
}

<span style=color:#75715e>// SayHelloURL bm demo func.
</span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>s</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Service</span>) <span style=color:#a6e22e>SayHelloURL</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>req</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>pb</span>.<span style=color:#a6e22e>HelloReq</span>) (<span style=color:#a6e22e>reply</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>pb</span>.<span style=color:#a6e22e>HelloResp</span>, <span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>) {
	<span style=color:#a6e22e>reply</span> = <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>pb</span>.<span style=color:#a6e22e>HelloResp</span>{
		<span style=color:#a6e22e>Content</span>: <span style=color:#e6db74>&#34;hello &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>Name</span>,
	}
	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;hello url %s&#34;</span>, <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>Name</span>)
	<span style=color:#66d9ef>return</span>
}

<span style=color:#75715e>// Ping ping the resource.
</span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>s</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Service</span>) <span style=color:#a6e22e>Ping</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>e</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>empty</span>.<span style=color:#a6e22e>Empty</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>empty</span>.<span style=color:#a6e22e>Empty</span>, <span style=color:#66d9ef>error</span>) {
	<span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>empty</span>.<span style=color:#a6e22e>Empty</span>{}, <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>dao</span>.<span style=color:#a6e22e>Ping</span>(<span style=color:#a6e22e>ctx</span>)
}

<span style=color:#75715e>// Close close the resource.
</span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>s</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Service</span>) <span style=color:#a6e22e>Close</span>() {}
</code></pre></div><p>å“‡å“¦ï¼Œç°åœ¨æˆ‘ä»¬çŸ¥é“äº†ï¼Œ<code>Service</code>æ˜¯ç”±ä¸€äº›<code>gRPC</code>æ–¹æ³•ï¼Œé…ç½®é¡¹ï¼Œæ¨¡å‹å±‚ç»„æˆçš„ã€‚</p><p>å¥½ï¼Œä¹˜èƒœè¿½å‡»æˆ‘ä»¬å†çœ‹ä¸€çœ‹<code>engine, err := http.New(serviceService)</code>åšäº†ä»€ä¹ˆã€‚</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>svc</span> <span style=color:#a6e22e>pb</span>.<span style=color:#a6e22e>DemoServer</span>

<span style=color:#75715e>// New new a bm server.
</span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>New</span>(<span style=color:#a6e22e>s</span> <span style=color:#a6e22e>pb</span>.<span style=color:#a6e22e>DemoServer</span>) (<span style=color:#a6e22e>engine</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>bm</span>.<span style=color:#a6e22e>Engine</span>, <span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>) {
	<span style=color:#66d9ef>var</span> (
		<span style=color:#a6e22e>cfg</span> <span style=color:#a6e22e>bm</span>.<span style=color:#a6e22e>ServerConfig</span>
		<span style=color:#a6e22e>ct</span>  <span style=color:#a6e22e>paladin</span>.<span style=color:#a6e22e>TOML</span>
	)
	<span style=color:#75715e>// è¯»å–ä½ çš„é…ç½®æ–‡ä»¶
</span><span style=color:#75715e></span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>paladin</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#e6db74>&#34;http.toml&#34;</span>).<span style=color:#a6e22e>Unmarshal</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>ct</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
		<span style=color:#66d9ef>return</span>
	}
	<span style=color:#75715e>// å¾—åˆ°http.tomlçš„Serverå­—æ®µ
</span><span style=color:#75715e></span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>ct</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#e6db74>&#34;Server&#34;</span>).<span style=color:#a6e22e>UnmarshalTOML</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>cfg</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
		<span style=color:#66d9ef>return</span>
	}
	<span style=color:#a6e22e>svc</span> = <span style=color:#a6e22e>s</span>

	<span style=color:#75715e>// åšä¸€ä¸ªæ–° engine 
</span><span style=color:#75715e></span>	<span style=color:#75715e>// (engine æ˜¯ Gin é‡Œçš„æ¨¡å—ï¼Œè¿™é‡Œæˆ‘å°±ä¸åˆ†æGinçš„æºç äº†)
</span><span style=color:#75715e></span>	<span style=color:#a6e22e>engine</span> = <span style=color:#a6e22e>bm</span>.<span style=color:#a6e22e>DefaultServer</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>cfg</span>)

	<span style=color:#75715e>// å°†gRPCæœåŠ¡æ³¨å†Œåˆ°engine, è¿™ä¸ªä»£ç æ³¨å†Œä»£ç æ˜¯bmè‡ªå·±ç”Ÿæˆçš„
</span><span style=color:#75715e></span>	<span style=color:#75715e>// ä¸€ä¼šæˆ‘ä»¬åˆ†æ
</span><span style=color:#75715e></span>	<span style=color:#a6e22e>pb</span>.<span style=color:#a6e22e>RegisterDemoBMServer</span>(<span style=color:#a6e22e>engine</span>, <span style=color:#a6e22e>s</span>)

	<span style=color:#75715e>// æŠŠä½ çš„è·¯ç”±æè¿›å»
</span><span style=color:#75715e></span>	<span style=color:#a6e22e>initRouter</span>(<span style=color:#a6e22e>engine</span>)

	<span style=color:#75715e>// å¼€å§‹è·‘
</span><span style=color:#75715e></span>	<span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>engine</span>.<span style=color:#a6e22e>Start</span>()
	<span style=color:#66d9ef>return</span>
}

<span style=color:#75715e>// è·¯ç”±åœ¨è¿™é‡Œç™»è®°ï¼
</span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>initRouter</span>(<span style=color:#a6e22e>e</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>bm</span>.<span style=color:#a6e22e>Engine</span>) {
	<span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Ping</span>(<span style=color:#a6e22e>ping</span>)
	<span style=color:#a6e22e>g</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Group</span>(<span style=color:#e6db74>&#34;/kratos-demo&#34;</span>)
	{
		<span style=color:#a6e22e>g</span>.<span style=color:#a6e22e>GET</span>(<span style=color:#e6db74>&#34;/start&#34;</span>, <span style=color:#a6e22e>howToStart</span>)
	}
}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>ping</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>bm</span>.<span style=color:#a6e22e>Context</span>) {
	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>svc</span>.<span style=color:#a6e22e>Ping</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#66d9ef>nil</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#e6db74>&#34;ping error(%v)&#34;</span>, <span style=color:#a6e22e>err</span>)
		<span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>AbortWithStatus</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusServiceUnavailable</span>)
	}
}

<span style=color:#75715e>// example for http request handler.
</span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>howToStart</span>(<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>bm</span>.<span style=color:#a6e22e>Context</span>) {
	<span style=color:#a6e22e>k</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>model</span>.<span style=color:#a6e22e>Kratos</span>{
		<span style=color:#a6e22e>Hello</span>: <span style=color:#e6db74>&#34;Golang å¤§æ³•å¥½ !!!æˆ‘å¥½ä½ ä¸ªå¤´ï¼&#34;</span>,
	}
	<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>JSON</span>(<span style=color:#a6e22e>k</span>, <span style=color:#66d9ef>nil</span>)
}

</code></pre></div><p>å¦‚æœä½ ä½¿ç”¨è¿‡<code>gin</code>è¿™ä¸ªwebæ¡†æ¶, ä¸Šé¢çš„ä»£ç ä½ ä¸€å®šå¾ˆç†Ÿæ‚‰ï¼Œå¯¹å§ï¼Ÿ
<code>bm</code>å°±æ˜¯<code>gin</code>ï¼Œåªæ˜¯éƒ¨åˆ†ä»£ç è¢«Bilibilié­”æ”¹äº†ï¼Œæ•´ä½“æ¶æ„æ˜¯ä¸å˜çš„ã€‚</p><p>OKï¼Œæˆ‘ä»¬çœ‹çœ‹<code>RegisterDemoBMServer</code>é‡Œåšäº†ä»€ä¹ˆ.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#75715e>// DemoBMServer is the server API for Demo service.
</span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>DemoBMServer</span> <span style=color:#66d9ef>interface</span> {
	<span style=color:#a6e22e>Ping</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>req</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>google_protobuf1</span>.<span style=color:#a6e22e>Empty</span>) (<span style=color:#a6e22e>resp</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>google_protobuf1</span>.<span style=color:#a6e22e>Empty</span>, <span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>)

	<span style=color:#a6e22e>SayHello</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>req</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>HelloReq</span>) (<span style=color:#a6e22e>resp</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>google_protobuf1</span>.<span style=color:#a6e22e>Empty</span>, <span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>)

	<span style=color:#a6e22e>SayHelloURL</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>req</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>HelloReq</span>) (<span style=color:#a6e22e>resp</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>HelloResp</span>, <span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>)
}

<span style=color:#75715e>// æˆ‘ä»¬å†™çš„gRPCæœåŠ¡
</span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>DemoSvc</span> <span style=color:#a6e22e>DemoBMServer</span>
<span style=color:#75715e>// ------------------------------------------------
</span><span style=color:#75715e></span>
<span style=color:#75715e>// æˆ‘ä»¬ä»”ç»†åˆ†æè¿™äº›æ–¹æ³•ä¸éš¾å‘ç°
</span><span style=color:#75715e>// ä»–ä»¬éƒ½ä¼šè°ƒç”¨ `BindWith` å’Œå¯¹åº”çš„gRPCæ–¹æ³•
</span><span style=color:#75715e></span>
<span style=color:#75715e>// å…ˆä½¿ç”¨BindWith: å°†requestä¸­çš„`Body` è½¬åŒ–ä¸ºgoä¸­çš„ `struct`
</span><span style=color:#75715e>// ç„¶åä½¿ç”¨gRPCæ–¹æ³•å¤„ç†è¯·æ±‚æ•°æ®
</span><span style=color:#75715e>// æœ€åè¿”å›
</span><span style=color:#75715e></span>
<span style=color:#75715e>// æœ¬è´¨å°±æ˜¯é€šè¿‡httpè°ƒç”¨gRPCæœåŠ¡
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>demoPing</span>(<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>bm</span>.<span style=color:#a6e22e>Context</span>) {
	<span style=color:#a6e22e>p</span> <span style=color:#f92672>:=</span> new(<span style=color:#a6e22e>google_protobuf1</span>.<span style=color:#a6e22e>Empty</span>)
	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>BindWith</span>(<span style=color:#a6e22e>p</span>, <span style=color:#a6e22e>binding</span>.<span style=color:#a6e22e>Default</span>(<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Request</span>.<span style=color:#a6e22e>Method</span>, <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Request</span>.<span style=color:#a6e22e>Header</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#e6db74>&#34;Content-Type&#34;</span>))); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
		<span style=color:#66d9ef>return</span>
	}
	<span style=color:#a6e22e>resp</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>DemoSvc</span>.<span style=color:#a6e22e>Ping</span>(<span style=color:#a6e22e>c</span>, <span style=color:#a6e22e>p</span>)
	<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>JSON</span>(<span style=color:#a6e22e>resp</span>, <span style=color:#a6e22e>err</span>)
}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>demoSayHello</span>(<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>bm</span>.<span style=color:#a6e22e>Context</span>) {
	<span style=color:#a6e22e>p</span> <span style=color:#f92672>:=</span> new(<span style=color:#a6e22e>HelloReq</span>)
	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>BindWith</span>(<span style=color:#a6e22e>p</span>, <span style=color:#a6e22e>binding</span>.<span style=color:#a6e22e>Default</span>(<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Request</span>.<span style=color:#a6e22e>Method</span>, <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Request</span>.<span style=color:#a6e22e>Header</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#e6db74>&#34;Content-Type&#34;</span>))); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
		<span style=color:#66d9ef>return</span>
	}
	<span style=color:#a6e22e>resp</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>DemoSvc</span>.<span style=color:#a6e22e>SayHello</span>(<span style=color:#a6e22e>c</span>, <span style=color:#a6e22e>p</span>)
	<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>JSON</span>(<span style=color:#a6e22e>resp</span>, <span style=color:#a6e22e>err</span>)
}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>demoSayHelloURL</span>(<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>bm</span>.<span style=color:#a6e22e>Context</span>) {
	<span style=color:#a6e22e>p</span> <span style=color:#f92672>:=</span> new(<span style=color:#a6e22e>HelloReq</span>)
	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>BindWith</span>(<span style=color:#a6e22e>p</span>, <span style=color:#a6e22e>binding</span>.<span style=color:#a6e22e>Default</span>(<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Request</span>.<span style=color:#a6e22e>Method</span>, <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Request</span>.<span style=color:#a6e22e>Header</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#e6db74>&#34;Content-Type&#34;</span>))); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
		<span style=color:#66d9ef>return</span>
	}
	<span style=color:#a6e22e>resp</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>DemoSvc</span>.<span style=color:#a6e22e>SayHelloURL</span>(<span style=color:#a6e22e>c</span>, <span style=color:#a6e22e>p</span>)
	<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>JSON</span>(<span style=color:#a6e22e>resp</span>, <span style=color:#a6e22e>err</span>)
}
<span style=color:#75715e>//-------------------------------------
</span><span style=color:#75715e></span>
<span style=color:#75715e>// RegisterDemoBMServer Register the blademaster route
</span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>RegisterDemoBMServer</span>(<span style=color:#a6e22e>e</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>bm</span>.<span style=color:#a6e22e>Engine</span>, <span style=color:#a6e22e>server</span> <span style=color:#a6e22e>DemoBMServer</span>) {
	<span style=color:#75715e>// server æ˜¯æˆ‘ä»¬ä¹‹å‰ç¼–å†™çš„gRPCæœåŠ¡
</span><span style=color:#75715e></span>	<span style=color:#a6e22e>DemoSvc</span> = <span style=color:#a6e22e>server</span>
	
	<span style=color:#75715e>// å°†ä¸€äº›æ–¹æ³•æ³¨å†Œåˆ°è·¯ç”±é‡Œå» 
</span><span style=color:#75715e></span>	<span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>GET</span>(<span style=color:#e6db74>&#34;/demo.service.v1.Demo/Ping&#34;</span>, <span style=color:#a6e22e>demoPing</span>)
	<span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>GET</span>(<span style=color:#e6db74>&#34;/demo.service.v1.Demo/SayHello&#34;</span>, <span style=color:#a6e22e>demoSayHello</span>)
	<span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>GET</span>(<span style=color:#e6db74>&#34;/kratos-demo/say_hello&#34;</span>, <span style=color:#a6e22e>demoSayHelloURL</span>)
}
</code></pre></div><p>å“‡ï¼ŒåŸæ¥åªæ˜¯æŠŠä¸€äº›gRPCçš„æœåŠ¡ç»‘å®šåˆ°<code>gin</code>çš„è·¯ç”±é‡Œäº†å‘€ã€‚
å€Ÿç”¨<code>gin</code>æ¥è°ƒç”¨gRPC.</p><p><code>grpc.New()</code>å°±ä¸åˆ†æäº†ã€‚</p><p>ç„¶åæ˜¯<code>AppNew()</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#75715e>//go:generate kratos tool wire
</span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>App</span> <span style=color:#66d9ef>struct</span> {
	<span style=color:#a6e22e>svc</span>  <span style=color:#f92672>*</span><span style=color:#a6e22e>service</span>.<span style=color:#a6e22e>Service</span>
	<span style=color:#a6e22e>http</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>bm</span>.<span style=color:#a6e22e>Engine</span>
	<span style=color:#a6e22e>grpc</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>warden</span>.<span style=color:#a6e22e>Server</span>
}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewApp</span>(<span style=color:#a6e22e>svc</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>service</span>.<span style=color:#a6e22e>Service</span>, <span style=color:#a6e22e>h</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>bm</span>.<span style=color:#a6e22e>Engine</span>, <span style=color:#a6e22e>g</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>warden</span>.<span style=color:#a6e22e>Server</span>) (<span style=color:#a6e22e>app</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>App</span>, <span style=color:#a6e22e>closeFunc</span> <span style=color:#66d9ef>func</span>(), <span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>) {
	<span style=color:#a6e22e>app</span> = <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>App</span>{
		<span style=color:#a6e22e>svc</span>:  <span style=color:#a6e22e>svc</span>,
		<span style=color:#a6e22e>http</span>: <span style=color:#a6e22e>h</span>,
		<span style=color:#a6e22e>grpc</span>: <span style=color:#a6e22e>g</span>,
	}

	<span style=color:#75715e>// ä¸€ä¸ªå…³é—­contextçš„å›è°ƒ
</span><span style=color:#75715e></span>	<span style=color:#a6e22e>closeFunc</span> = <span style=color:#66d9ef>func</span>() {
		<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>cancel</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>WithTimeout</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>(), <span style=color:#ae81ff>35</span><span style=color:#f92672>*</span><span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>)
		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>g</span>.<span style=color:#a6e22e>Shutdown</span>(<span style=color:#a6e22e>ctx</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
			<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#e6db74>&#34;grpcSrv.Shutdown error(%v)&#34;</span>, <span style=color:#a6e22e>err</span>)
		}
		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>h</span>.<span style=color:#a6e22e>Shutdown</span>(<span style=color:#a6e22e>ctx</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
			<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#e6db74>&#34;httpSrv.Shutdown error(%v)&#34;</span>, <span style=color:#a6e22e>err</span>)
		}
		<span style=color:#a6e22e>cancel</span>()
	}
	<span style=color:#66d9ef>return</span>
}
</code></pre></div><p>åˆ°è¿™é‡Œåˆå§‹åŒ–æ˜¯ç»“æŸäº†ã€‚</p><h1 id=summary>Summary</h1><p><code>kratos</code>çš„åˆå§‹åŒ–æµç¨‹:</p><ul><li>è¯»å–é…ç½®æ–‡ä»¶</li><li>å®ä¾‹åŒ–Daoå±‚</li><li>å®ä¾‹åŒ–gRPCæœåŠ¡</li><li>å®ä¾‹åŒ–ginçš„engine</li><li>æ³¨å†ŒgPRCåˆ°engine</li><li>å¯åŠ¨engine</li><li>å¯åŠ¨gRPCæœåŠ¡ç«¯</li><li>è·å¾—æ•´ä¸ªç¨‹åºå…³é—­çš„å›è°ƒ</li></ul><p>æˆ‘åˆ†å¾—åº”è¯¥è¿˜æ˜¯æ¯”è¾ƒç»†çš„ã€‚</p><p>åé¢åº”è¯¥è¿˜ä¼šåˆ†æ<code>warden</code>ï¼Œå®ƒæ˜¯<code>Kratos</code>åœ¨<code>grpc</code>åŸç‰ˆä¸Šçš„ä¸€ä¸ªå°è£…ç‰ˆæœ¬ã€‚</p><p>æºœäº†æºœäº†&mldr;</p></content><p><a href=https://sdttttt.github.io/tags/microservice/>#microservice</a>
<a href=https://sdttttt.github.io/tags/source-code-analysis/>#Source code analysis</a></p></main><footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/gitalk@1.7.0/dist/gitalk.css><script src=https://cdn.jsdelivr.net/npm/gitalk@1.7.0/dist/gitalk.min.js></script><div id=gitalk-container></div><script>var gitalk=new Gitalk({clientID:'747ab8530477531c3d25',clientSecret:'af2cc18e4c27998636a6a3c82af0064f38574170',repo:'sdttttt.github.io',owner:'sdttttt',admin:['sdttttt'],id:location.pathname,distractionFreeMode:true})
gitalk.render('gitalk-container')</script></footer></body></html>