<!doctype html><html lang=zh-cn><head><meta http-equiv=x-clacks-overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0"><link rel="shortcut icon" href=https://sdttttt.github.io/favicon.ico><title>File Upload | SDTTTTT's Smelly fish Rotten shrimp ğŸ““</title><meta name=title content="File Upload"><meta name=description content="DVWA File upload è¿‡å…³ç§˜ç±.
LOW if( isset( $_POST[ 'Upload' ] ) ) { // Where are we going to be writing to?  $target_path = DVWA_WEB_PAGE_TO_ROOT . &#34;hackable/uploads/&#34;; $target_path .= basename( $_FILES[ 'uploaded' ][ 'name' ] ); // Can we move the file to the upload folder?  // å®Œå…¨æ²¡åšè¿‡æ»¤.  // ä¸Šä¼ ä¸€ä¸ªPHPæ–‡ä»¶ä¹Ÿæ˜¯å¯ä»¥çš„.  if( !move_uploaded_file( $_FILES[ 'uploaded' ][ 'tmp_name' ], $target_path ) ) { // No  echo '<pre>Your image was not uploaded."><meta name=keywords content="penetration test,"><meta property="og:title" content="File Upload"><meta property="og:description" content="DVWA File upload è¿‡å…³ç§˜ç±.
LOW if( isset( $_POST[ 'Upload' ] ) ) { // Where are we going to be writing to?  $target_path = DVWA_WEB_PAGE_TO_ROOT . &#34;hackable/uploads/&#34;; $target_path .= basename( $_FILES[ 'uploaded' ][ 'name' ] ); // Can we move the file to the upload folder?  // å®Œå…¨æ²¡åšè¿‡æ»¤.  // ä¸Šä¼ ä¸€ä¸ªPHPæ–‡ä»¶ä¹Ÿæ˜¯å¯ä»¥çš„.  if( !move_uploaded_file( $_FILES[ 'uploaded' ][ 'tmp_name' ], $target_path ) ) { // No  echo '<pre>Your image was not uploaded."><meta property="og:type" content="article"><meta property="og:url" content="https://sdttttt.github.io/blog/file_upload/"><meta property="og:image" content="https://sdttttt.github.io/static/me.jpg"><meta property="article:published_time" content="2020-04-12T10:46:06+08:00"><meta property="article:modified_time" content="2020-09-24T18:06:32+08:00"><meta property="og:site_name" content="SDTTTTT"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://sdttttt.github.io/static/me.jpg"><meta name=twitter:title content="File Upload"><meta name=twitter:description content="DVWA File upload è¿‡å…³ç§˜ç±.
LOW if( isset( $_POST[ 'Upload' ] ) ) { // Where are we going to be writing to?  $target_path = DVWA_WEB_PAGE_TO_ROOT . &#34;hackable/uploads/&#34;; $target_path .= basename( $_FILES[ 'uploaded' ][ 'name' ] ); // Can we move the file to the upload folder?  // å®Œå…¨æ²¡åšè¿‡æ»¤.  // ä¸Šä¼ ä¸€ä¸ªPHPæ–‡ä»¶ä¹Ÿæ˜¯å¯ä»¥çš„.  if( !move_uploaded_file( $_FILES[ 'uploaded' ][ 'tmp_name' ], $target_path ) ) { // No  echo '<pre>Your image was not uploaded."><meta itemprop=name content="File Upload"><meta itemprop=description content="DVWA File upload è¿‡å…³ç§˜ç±.
LOW if( isset( $_POST[ 'Upload' ] ) ) { // Where are we going to be writing to?  $target_path = DVWA_WEB_PAGE_TO_ROOT . &#34;hackable/uploads/&#34;; $target_path .= basename( $_FILES[ 'uploaded' ][ 'name' ] ); // Can we move the file to the upload folder?  // å®Œå…¨æ²¡åšè¿‡æ»¤.  // ä¸Šä¼ ä¸€ä¸ªPHPæ–‡ä»¶ä¹Ÿæ˜¯å¯ä»¥çš„.  if( !move_uploaded_file( $_FILES[ 'uploaded' ][ 'tmp_name' ], $target_path ) ) { // No  echo '<pre>Your image was not uploaded."><meta itemprop=datePublished content="2020-04-12T10:46:06+08:00"><meta itemprop=dateModified content="2020-09-24T18:06:32+08:00"><meta itemprop=wordCount content="1026"><meta itemprop=image content="https://sdttttt.github.io/static/me.jpg"><meta itemprop=keywords content="penetration test,"><meta name=referrer content="no-referrer-when-downgrade"><style>body{font-family:Verdana,sans-serif;margin:auto;padding:20px;max-width:720px;text-align:left;background-color:#fff;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444}h1,h2,h3,h4,h5,h6,strong,b{color:#222}a{color:#3273dc}.title{text-decoration:none;border:0}.title span{font-weight:400}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#eee}pre code{border-left:1px solid #999;color:#555;display:block;padding:10px;white-space:pre-wrap}blockquote{border-left:1px solid #999;color:#555;padding-left:10px;font-style:italic}footer{padding:25px;text-align:center}.helptext{color:#777;font-size:small}.errorlist{color:#eba613;font-size:small}</style></head><body><header><a href=/ class=title><h2>SDTTTTT's Smelly fish Rotten shrimp ğŸ““</h2></a><nav><a href=/>Home</a>
<a href=/blog>Blog</a></nav></header><main><h1>File Upload</h1><hr><p><i><time datetime=2020-04-12 pubdate>12 Apr, 2020</time></i></p><content><p>DVWA File upload è¿‡å…³ç§˜ç±.</p><h3 id=low>LOW</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-PHP data-lang=PHP><span style=color:#66d9ef>if</span>( <span style=color:#a6e22e>isset</span>( $_POST[ <span style=color:#e6db74>&#39;Upload&#39;</span> ] ) ) {
    <span style=color:#75715e>// Where are we going to be writing to?
</span><span style=color:#75715e></span>    $target_path  <span style=color:#f92672>=</span> <span style=color:#a6e22e>DVWA_WEB_PAGE_TO_ROOT</span> <span style=color:#f92672>.</span> <span style=color:#e6db74>&#34;hackable/uploads/&#34;</span>;
    $target_path <span style=color:#f92672>.=</span> <span style=color:#a6e22e>basename</span>( $_FILES[ <span style=color:#e6db74>&#39;uploaded&#39;</span> ][ <span style=color:#e6db74>&#39;name&#39;</span> ] );

    <span style=color:#75715e>// Can we move the file to the upload folder?
</span><span style=color:#75715e></span>    <span style=color:#75715e>// å®Œå…¨æ²¡åšè¿‡æ»¤.
</span><span style=color:#75715e></span>    <span style=color:#75715e>// ä¸Šä¼ ä¸€ä¸ªPHPæ–‡ä»¶ä¹Ÿæ˜¯å¯ä»¥çš„.
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span>( <span style=color:#f92672>!</span><span style=color:#a6e22e>move_uploaded_file</span>( $_FILES[ <span style=color:#e6db74>&#39;uploaded&#39;</span> ][ <span style=color:#e6db74>&#39;tmp_name&#39;</span> ], $target_path ) ) {
        <span style=color:#75715e>// No
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;&lt;pre&gt;Your image was not uploaded.&lt;/pre&gt;&#39;</span>;
    }
    <span style=color:#66d9ef>else</span> {
        <span style=color:#75715e>// Yes!
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;&lt;pre&gt;</span><span style=color:#e6db74>{</span>$target_path<span style=color:#e6db74>}</span><span style=color:#e6db74> succesfully uploaded!&lt;/pre&gt;&#34;</span>;
    }
}
</code></pre></div><h3 id=medium>Medium</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-PHP data-lang=PHP><span style=color:#66d9ef>if</span>( <span style=color:#a6e22e>isset</span>( $_POST[ <span style=color:#e6db74>&#39;Upload&#39;</span> ] ) ) {
    <span style=color:#75715e>// Where are we going to be writing to?
</span><span style=color:#75715e></span>    $target_path  <span style=color:#f92672>=</span> <span style=color:#a6e22e>DVWA_WEB_PAGE_TO_ROOT</span> <span style=color:#f92672>.</span> <span style=color:#e6db74>&#34;hackable/uploads/&#34;</span>;
    $target_path <span style=color:#f92672>.=</span> <span style=color:#a6e22e>basename</span>( $_FILES[ <span style=color:#e6db74>&#39;uploaded&#39;</span> ][ <span style=color:#e6db74>&#39;name&#39;</span> ] );

    <span style=color:#75715e>// File information
</span><span style=color:#75715e></span>    $uploaded_name <span style=color:#f92672>=</span> $_FILES[ <span style=color:#e6db74>&#39;uploaded&#39;</span> ][ <span style=color:#e6db74>&#39;name&#39;</span> ];
    $uploaded_type <span style=color:#f92672>=</span> $_FILES[ <span style=color:#e6db74>&#39;uploaded&#39;</span> ][ <span style=color:#e6db74>&#39;type&#39;</span> ];
    $uploaded_size <span style=color:#f92672>=</span> $_FILES[ <span style=color:#e6db74>&#39;uploaded&#39;</span> ][ <span style=color:#e6db74>&#39;size&#39;</span> ];

    <span style=color:#75715e>// Is it an image?
</span><span style=color:#75715e></span>    <span style=color:#75715e>// // å¼€å§‹åšäº†ä¸€äº›è¿‡æ»¤
</span><span style=color:#75715e></span>
    <span style=color:#75715e>// ä¸‹é¢æ˜¯å®˜æ–¹å¯¹$_FILES å‡½æ•°çš„æè¿°
</span><span style=color:#75715e></span>    <span style=color:#75715e>//  [name] =&gt; MyFile.txt (comes from the browser, so treat as tainted)
</span><span style=color:#75715e></span>    <span style=color:#75715e>//         [type] =&gt; text/plain  (not sure where it gets this from - assume the browser, so treat as tainted)
</span><span style=color:#75715e></span>    <span style=color:#75715e>//         [tmp_name] =&gt; /tmp/php/php1h4j1o (could be anywhere on your system, depending on your config        settings, but the user has no control, so this isn&#39;t tainted)
</span><span style=color:#75715e></span>    <span style=color:#75715e>//         [error] =&gt; UPLOAD_ERR_OK  (= 0)
</span><span style=color:#75715e></span>    <span style=color:#75715e>//         [size] =&gt; 123   (the size in bytes)
</span><span style=color:#75715e></span>    
    <span style=color:#75715e>// å…¶ä¸­å¯¹nameå’Œtypeçš„descriptionçš„æè¿°éƒ½æ˜¯ `treat as tainted`(è¢«æ±¡æŸ“çš„)
</span><span style=color:#75715e></span>    <span style=color:#75715e>// è¿™æ„å‘³ç€å®ƒæœ‰å¯èƒ½ä¼šè¢«ä¿®æ”¹ unsafe
</span><span style=color:#75715e></span>    
    <span style=color:#75715e>// æˆ‘ä»¬å¯ä»¥å°è¯•ä¸Šä¼ ä¸€ä¸ªPHPæ–‡ä»¶ï¼Œä½¿ç”¨ä¸€äº›æ‹¦æˆªè¯·æ±‚å·¥å…·ï¼Œä¿®æ”¹å³å°†å‘å‡ºçš„è¯·æ±‚.
</span><span style=color:#75715e></span>    <span style=color:#75715e>// æ¥è¾¾åˆ°ä¿®æ”¹`name`ä¸­çš„åç¼€åå’Œ`type`ä¸­çš„åª’ä½“ç±»å‹.
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span>( ( $uploaded_type <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;image/jpeg&#34;</span> <span style=color:#f92672>||</span> $uploaded_type <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;image/png&#34;</span> ) <span style=color:#f92672>&amp;&amp;</span>
        ( $uploaded_size <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>100000</span> ) ) {

        <span style=color:#75715e>// Can we move the file to the upload folder?
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span>( <span style=color:#f92672>!</span><span style=color:#a6e22e>move_uploaded_file</span>( $_FILES[ <span style=color:#e6db74>&#39;uploaded&#39;</span> ][ <span style=color:#e6db74>&#39;tmp_name&#39;</span> ], $target_path ) ) {
            <span style=color:#75715e>// No
</span><span style=color:#75715e></span>            <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;&lt;pre&gt;Your image was not uploaded.&lt;/pre&gt;&#39;</span>;
        }
        <span style=color:#66d9ef>else</span> {
            <span style=color:#75715e>// Yes!
</span><span style=color:#75715e></span>            <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;&lt;pre&gt;</span><span style=color:#e6db74>{</span>$target_path<span style=color:#e6db74>}</span><span style=color:#e6db74> succesfully uploaded!&lt;/pre&gt;&#34;</span>;
        }
    }
    <span style=color:#66d9ef>else</span> {
        <span style=color:#75715e>// Invalid file
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;&lt;pre&gt;Your image was not uploaded. We can only accept JPEG or PNG images.&lt;/pre&gt;&#39;</span>;
    }
}
</code></pre></div><h3 id=high>High</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-PHP data-lang=PHP><span style=color:#66d9ef>if</span>( <span style=color:#a6e22e>isset</span>( $_POST[ <span style=color:#e6db74>&#39;Upload&#39;</span> ] ) ) {
    <span style=color:#75715e>// Where are we going to be writing to?
</span><span style=color:#75715e></span>    $target_path  <span style=color:#f92672>=</span> <span style=color:#a6e22e>DVWA_WEB_PAGE_TO_ROOT</span> <span style=color:#f92672>.</span> <span style=color:#e6db74>&#34;hackable/uploads/&#34;</span>;
    $target_path <span style=color:#f92672>.=</span> <span style=color:#a6e22e>basename</span>( $_FILES[ <span style=color:#e6db74>&#39;uploaded&#39;</span> ][ <span style=color:#e6db74>&#39;name&#39;</span> ] );

    <span style=color:#75715e>// File information
</span><span style=color:#75715e></span>    $uploaded_name <span style=color:#f92672>=</span> $_FILES[ <span style=color:#e6db74>&#39;uploaded&#39;</span> ][ <span style=color:#e6db74>&#39;name&#39;</span> ];
        <span style=color:#75715e>// jpg
</span><span style=color:#75715e></span>    $uploaded_ext  <span style=color:#f92672>=</span> <span style=color:#a6e22e>substr</span>( $uploaded_name, <span style=color:#a6e22e>strrpos</span>( $uploaded_name, <span style=color:#e6db74>&#39;.&#39;</span> ) <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>);
    
    <span style=color:#75715e>// file size
</span><span style=color:#75715e></span>    $uploaded_size <span style=color:#f92672>=</span> $_FILES[ <span style=color:#e6db74>&#39;uploaded&#39;</span> ][ <span style=color:#e6db74>&#39;size&#39;</span> ];
    
    <span style=color:#75715e>// tmp_name æ˜¯ä¸´æ—¶å‰¯æœ¬çš„åå­—
</span><span style=color:#75715e></span>    $uploaded_tmp  <span style=color:#f92672>=</span> $_FILES[ <span style=color:#e6db74>&#39;uploaded&#39;</span> ][ <span style=color:#e6db74>&#39;tmp_name&#39;</span> ];

    <span style=color:#75715e>// Is it an image?
</span><span style=color:#75715e></span>    <span style=color:#75715e>// å’Œä¸Šé¢çš„æ¯”èµ·æ¥å¤šä¸ªä¸€ä¸ªæ–‡ä»¶åç¼€åçš„åˆ¤æ–­.
</span><span style=color:#75715e></span>    <span style=color:#75715e>// strtolower è½¬å°å†™
</span><span style=color:#75715e></span>    <span style=color:#75715e>// æ‰©å±•ååªè¦æ»¡è¶³jpeg,pngæˆ–è€…jpgå°±è¡Œ
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span>( ( <span style=color:#a6e22e>strtolower</span>( $uploaded_ext ) <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;jpg&#34;</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>strtolower</span>( $uploaded_ext ) <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;jpeg&#34;</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>strtolower</span>( $uploaded_ext ) <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;png&#34;</span> ) <span style=color:#f92672>&amp;&amp;</span>
        ( $uploaded_size <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>100000</span> ) <span style=color:#f92672>&amp;&amp;</span>
        <span style=color:#75715e>// getimagesize è·å–å›¾åƒä¿¡æ¯
</span><span style=color:#75715e></span>        <span style=color:#75715e>// è¿™ä¸ªå‡½æ•°ä¿è¯ä½ ç©¿çš„ä¸€å®šå¾—æ˜¯ä¸ªå›¾åƒ
</span><span style=color:#75715e></span>        <span style=color:#75715e>// å¯ä»¥ç”¨å›¾ç‰‡æœ¨é©¬ç»•è¿‡
</span><span style=color:#75715e></span>        <span style=color:#a6e22e>getimagesize</span>( $uploaded_tmp ) ) {

        <span style=color:#75715e>// Can we move the file to the upload folder?
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span>( <span style=color:#f92672>!</span><span style=color:#a6e22e>move_uploaded_file</span>( $uploaded_tmp, $target_path ) ) {
            <span style=color:#75715e>// No
</span><span style=color:#75715e></span>            <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;&lt;pre&gt;Your image was not uploaded.&lt;/pre&gt;&#39;</span>;
        }
        <span style=color:#66d9ef>else</span> {
            <span style=color:#75715e>// Yes!
</span><span style=color:#75715e></span>            <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;&lt;pre&gt;</span><span style=color:#e6db74>{</span>$target_path<span style=color:#e6db74>}</span><span style=color:#e6db74> succesfully uploaded!&lt;/pre&gt;&#34;</span>;
        }
    }
    <span style=color:#66d9ef>else</span> {
        <span style=color:#75715e>// Invalid file
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;&lt;pre&gt;Your image was not uploaded. We can only accept JPEG or PNG images.&lt;/pre&gt;&#39;</span>;
    }
}
</code></pre></div><h3 id=high-1>High</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-PHP data-lang=PHP><span style=color:#66d9ef>if</span>( <span style=color:#a6e22e>isset</span>( $_POST[ <span style=color:#e6db74>&#39;Upload&#39;</span> ] ) ) {
    <span style=color:#75715e>// Where are we going to be writing to?
</span><span style=color:#75715e></span>    $target_path  <span style=color:#f92672>=</span> <span style=color:#a6e22e>DVWA_WEB_PAGE_TO_ROOT</span> <span style=color:#f92672>.</span> <span style=color:#e6db74>&#34;hackable/uploads/&#34;</span>;
    $target_path <span style=color:#f92672>.=</span> <span style=color:#a6e22e>basename</span>( $_FILES[ <span style=color:#e6db74>&#39;uploaded&#39;</span> ][ <span style=color:#e6db74>&#39;name&#39;</span> ] );

    <span style=color:#75715e>// File information
</span><span style=color:#75715e></span>    $uploaded_name <span style=color:#f92672>=</span> $_FILES[ <span style=color:#e6db74>&#39;uploaded&#39;</span> ][ <span style=color:#e6db74>&#39;name&#39;</span> ];
    $uploaded_ext  <span style=color:#f92672>=</span> <span style=color:#a6e22e>substr</span>( $uploaded_name, <span style=color:#a6e22e>strrpos</span>( $uploaded_name, <span style=color:#e6db74>&#39;.&#39;</span> ) <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>);
    $uploaded_size <span style=color:#f92672>=</span> $_FILES[ <span style=color:#e6db74>&#39;uploaded&#39;</span> ][ <span style=color:#e6db74>&#39;size&#39;</span> ];
    $uploaded_tmp  <span style=color:#f92672>=</span> $_FILES[ <span style=color:#e6db74>&#39;uploaded&#39;</span> ][ <span style=color:#e6db74>&#39;tmp_name&#39;</span> ];

    <span style=color:#75715e>// Is it an image?
</span><span style=color:#75715e></span>    <span style=color:#75715e>// å¯¹æ¯”ä¸Šé¢å¤šéªŒè¯äº†æ–‡ä»¶çš„åç¼€å
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span>( ( <span style=color:#a6e22e>strtolower</span>( $uploaded_ext ) <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;jpg&#34;</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>strtolower</span>( $uploaded_ext ) <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;jpeg&#34;</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>strtolower</span>( $uploaded_ext ) <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;png&#34;</span> ) <span style=color:#f92672>&amp;&amp;</span>
        ( $uploaded_size <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>100000</span> ) <span style=color:#f92672>&amp;&amp;</span>

        
       
        <span style=color:#75715e>// å‡½æ•°ä¼šé€šè¿‡è¯»å–æ–‡ä»¶å¤´ï¼Œè¿”å›å›¾ç‰‡çš„é•¿ã€å®½ç­‰ä¿¡æ¯ï¼Œå¦‚æœæ²¡æœ‰ç›¸å…³çš„å›¾ç‰‡æ–‡ä»¶å¤´ï¼Œå‡½æ•°ä¼šæŠ¥é”™
</span><span style=color:#75715e></span>        <span style=color:#a6e22e>getimagesize</span>( $uploaded_tmp ) ) {

        <span style=color:#75715e>// å¯ä»¥çœ‹åˆ°ï¼ŒHighçº§åˆ«çš„ä»£ç è¯»å–æ–‡ä»¶åä¸­æœ€åä¸€ä¸ªâ€.â€åçš„å­—ç¬¦ä¸²ï¼ŒæœŸæœ›é€šè¿‡æ–‡ä»¶åæ¥é™åˆ¶æ–‡ä»¶ç±»å‹
</span><span style=color:#75715e></span>        <span style=color:#75715e>// å› æ­¤è¦æ±‚ä¸Šä¼ æ–‡ä»¶åå½¢å¼å¿…é¡»æ˜¯â€*.jpgâ€ã€â€*.jpegâ€ ã€â€*.pngâ€ä¹‹ä¸€
</span><span style=color:#75715e></span>        <span style=color:#75715e>// åŒæ—¶ï¼Œgetimagesizeå‡½æ•°æ›´æ˜¯é™åˆ¶äº†ä¸Šä¼ æ–‡ä»¶çš„æ–‡ä»¶å¤´å¿…é¡»ä¸ºå›¾åƒç±»å‹
</span><span style=color:#75715e></span>
        <span style=color:#75715e>// Can we move the file to the upload folder?
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span>( <span style=color:#f92672>!</span><span style=color:#a6e22e>move_uploaded_file</span>( $uploaded_tmp, $target_path ) ) {
            <span style=color:#75715e>// No
</span><span style=color:#75715e></span>            <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;&lt;pre&gt;Your image was not uploaded.&lt;/pre&gt;&#39;</span>;
        }
        <span style=color:#66d9ef>else</span> {
            <span style=color:#75715e>// Yes!
</span><span style=color:#75715e></span>            <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;&lt;pre&gt;</span><span style=color:#e6db74>{</span>$target_path<span style=color:#e6db74>}</span><span style=color:#e6db74> succesfully uploaded!&lt;/pre&gt;&#34;</span>;
        }
    }
    <span style=color:#66d9ef>else</span> {
        <span style=color:#75715e>// Invalid file
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;&lt;pre&gt;Your image was not uploaded. We can only accept JPEG or PNG images.&lt;/pre&gt;&#39;</span>;
    }
}
</code></pre></div><h3 id=impossible>Impossible</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-PHP data-lang=PHP><span style=color:#66d9ef>if</span>( <span style=color:#a6e22e>isset</span>( $_POST[ <span style=color:#e6db74>&#39;Upload&#39;</span> ] ) ) {
    <span style=color:#75715e>// Check Anti-CSRF token
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>checkToken</span>( $_REQUEST[ <span style=color:#e6db74>&#39;user_token&#39;</span> ], $_SESSION[ <span style=color:#e6db74>&#39;session_token&#39;</span> ], <span style=color:#e6db74>&#39;index.php&#39;</span> );

    <span style=color:#75715e>// File information
</span><span style=color:#75715e></span>    $uploaded_name <span style=color:#f92672>=</span> $_FILES[ <span style=color:#e6db74>&#39;uploaded&#39;</span> ][ <span style=color:#e6db74>&#39;name&#39;</span> ];
    $uploaded_ext  <span style=color:#f92672>=</span> <span style=color:#a6e22e>substr</span>( $uploaded_name, <span style=color:#a6e22e>strrpos</span>( $uploaded_name, <span style=color:#e6db74>&#39;.&#39;</span> ) <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>);
    $uploaded_size <span style=color:#f92672>=</span> $_FILES[ <span style=color:#e6db74>&#39;uploaded&#39;</span> ][ <span style=color:#e6db74>&#39;size&#39;</span> ];
    $uploaded_type <span style=color:#f92672>=</span> $_FILES[ <span style=color:#e6db74>&#39;uploaded&#39;</span> ][ <span style=color:#e6db74>&#39;type&#39;</span> ];
    $uploaded_tmp  <span style=color:#f92672>=</span> $_FILES[ <span style=color:#e6db74>&#39;uploaded&#39;</span> ][ <span style=color:#e6db74>&#39;tmp_name&#39;</span> ];

    <span style=color:#75715e>// Where are we going to be writing to?
</span><span style=color:#75715e></span>    $target_path   <span style=color:#f92672>=</span> <span style=color:#a6e22e>DVWA_WEB_PAGE_TO_ROOT</span> <span style=color:#f92672>.</span> <span style=color:#e6db74>&#39;hackable/uploads/&#39;</span>;
    <span style=color:#75715e>//$target_file   = basename( $uploaded_name, &#39;.&#39; . $uploaded_ext ) . &#39;-&#39;;
</span><span style=color:#75715e></span>
    <span style=color:#75715e>// MD5 åŠ å¯†
</span><span style=color:#75715e></span>    $target_file   <span style=color:#f92672>=</span>  <span style=color:#a6e22e>md5</span>( <span style=color:#a6e22e>uniqid</span>() <span style=color:#f92672>.</span> $uploaded_name ) <span style=color:#f92672>.</span> <span style=color:#e6db74>&#39;.&#39;</span> <span style=color:#f92672>.</span> $uploaded_ext;
    $temp_file     <span style=color:#f92672>=</span> ( ( <span style=color:#a6e22e>ini_get</span>( <span style=color:#e6db74>&#39;upload_tmp_dir&#39;</span> ) <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;&#39;</span> ) <span style=color:#f92672>?</span> ( <span style=color:#a6e22e>sys_get_temp_dir</span>() ) <span style=color:#f92672>:</span> ( <span style=color:#a6e22e>ini_get</span>( <span style=color:#e6db74>&#39;upload_tmp_dir&#39;</span> ) ) );
    $temp_file    <span style=color:#f92672>.=</span> <span style=color:#a6e22e>DIRECTORY_SEPARATOR</span> <span style=color:#f92672>.</span> <span style=color:#a6e22e>md5</span>( <span style=color:#a6e22e>uniqid</span>() <span style=color:#f92672>.</span> $uploaded_name ) <span style=color:#f92672>.</span> <span style=color:#e6db74>&#39;.&#39;</span> <span style=color:#f92672>.</span> $uploaded_ext;

    <span style=color:#75715e>// Is it an image?
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span>( ( <span style=color:#a6e22e>strtolower</span>( $uploaded_ext ) <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;jpg&#39;</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>strtolower</span>( $uploaded_ext ) <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;jpeg&#39;</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>strtolower</span>( $uploaded_ext ) <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;png&#39;</span> ) <span style=color:#f92672>&amp;&amp;</span>
        ( $uploaded_size <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>100000</span> ) <span style=color:#f92672>&amp;&amp;</span>
        ( $uploaded_type <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;image/jpeg&#39;</span> <span style=color:#f92672>||</span> $uploaded_type <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;image/png&#39;</span> ) <span style=color:#f92672>&amp;&amp;</span>
        <span style=color:#a6e22e>getimagesize</span>( $uploaded_tmp ) ) {

        <span style=color:#75715e>// Strip any metadata, by re-encoding image (Note, using php-Imagick is recommended over php-GD)
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span>( $uploaded_type <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;image/jpeg&#39;</span> ) {
            $img <span style=color:#f92672>=</span> <span style=color:#a6e22e>imagecreatefromjpeg</span>( $uploaded_tmp );
            <span style=color:#a6e22e>imagejpeg</span>( $img, $temp_file, <span style=color:#ae81ff>100</span>);
        }
        <span style=color:#66d9ef>else</span> {
            $img <span style=color:#f92672>=</span> <span style=color:#a6e22e>imagecreatefrompng</span>( $uploaded_tmp );
            <span style=color:#a6e22e>imagepng</span>( $img, $temp_file, <span style=color:#ae81ff>9</span>);
        }
        <span style=color:#a6e22e>imagedestroy</span>( $img );

        <span style=color:#75715e>// Can we move the file to the web root from the temp folder?
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span>( <span style=color:#a6e22e>rename</span>( $temp_file, ( <span style=color:#a6e22e>getcwd</span>() <span style=color:#f92672>.</span> <span style=color:#a6e22e>DIRECTORY_SEPARATOR</span> <span style=color:#f92672>.</span> $target_path <span style=color:#f92672>.</span> $target_file ) ) ) {
            <span style=color:#75715e>// Yes!
</span><span style=color:#75715e></span>            <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;&lt;pre&gt;&lt;a href=&#39;</span><span style=color:#e6db74>${</span>target_path}${target_file}&#39;&gt;${target_file<span style=color:#e6db74>}</span><span style=color:#e6db74>&lt;/a&gt; succesfully uploaded!&lt;/pre&gt;&#34;</span>;
        }
        <span style=color:#66d9ef>else</span> {
            <span style=color:#75715e>// No
</span><span style=color:#75715e></span>            <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;&lt;pre&gt;Your image was not uploaded.&lt;/pre&gt;&#39;</span>;
        }

        <span style=color:#75715e>// Delete any temp files
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span>( <span style=color:#a6e22e>file_exists</span>( $temp_file ) )
            <span style=color:#a6e22e>unlink</span>( $temp_file );
    }
    <span style=color:#66d9ef>else</span> {
        <span style=color:#75715e>// Invalid file
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;&lt;pre&gt;Your image was not uploaded. We can only accept JPEG or PNG images.&lt;/pre&gt;&#39;</span>;
    }
}

<span style=color:#75715e>// Generate Anti-CSRF token
</span><span style=color:#75715e></span><span style=color:#a6e22e>generateSessionToken</span>();
</code></pre></div><h3 id=extension>Extension</h3><p><strong>00%æˆªæ–­</strong></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-PHP data-lang=PHP>$is_upload <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
$msg <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
<span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>isset</span>($_POST[<span style=color:#e6db74>&#39;submit&#39;</span>])){
    <span style=color:#75715e>// ç™½åå•
</span><span style=color:#75715e></span>    $ext_arr <span style=color:#f92672>=</span> <span style=color:#66d9ef>array</span>(<span style=color:#e6db74>&#39;jpg&#39;</span>,<span style=color:#e6db74>&#39;png&#39;</span>,<span style=color:#e6db74>&#39;gif&#39;</span>);
    $file_ext <span style=color:#f92672>=</span> <span style=color:#a6e22e>substr</span>($_FILES[<span style=color:#e6db74>&#39;upload_file&#39;</span>][<span style=color:#e6db74>&#39;name&#39;</span>],<span style=color:#a6e22e>strrpos</span>($_FILES[<span style=color:#e6db74>&#39;upload_file&#39;</span>][<span style=color:#e6db74>&#39;name&#39;</span>],<span style=color:#e6db74>&#34;.&#34;</span>)<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>);
    <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>in_array</span>($file_ext,$ext_arr)){
        $temp_file <span style=color:#f92672>=</span> $_FILES[<span style=color:#e6db74>&#39;upload_file&#39;</span>][<span style=color:#e6db74>&#39;tmp_name&#39;</span>];
        <span style=color:#75715e>// æ³¨æ„è¿™ä¸ªä½ç½®
</span><span style=color:#75715e></span>        <span style=color:#75715e>// æœ€åæ‹¼æ¥çš„å‚¨å­˜è·¯å¾„ï¼Œæ˜¯ç”±ç”¨æˆ·æäº¤ä¸Šçš„æ•°æ®æ¥åšä¸ºè·¯å¾„
</span><span style=color:#75715e></span>        $img_path <span style=color:#f92672>=</span> $_POST[<span style=color:#e6db74>&#39;save_path&#39;</span>]<span style=color:#f92672>.</span><span style=color:#e6db74>&#34;/&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>rand</span>(<span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>99</span>)<span style=color:#f92672>.</span><span style=color:#a6e22e>date</span>(<span style=color:#e6db74>&#34;YmdHis&#34;</span>)<span style=color:#f92672>.</span><span style=color:#e6db74>&#34;.&#34;</span><span style=color:#f92672>.</span>$file_ext;

        <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>move_uploaded_file</span>($temp_file,$img_path)){
            $is_upload <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
        } <span style=color:#66d9ef>else</span> {
            $msg <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ä¸Šä¼ å¤±è´¥&#34;</span>;
        }
    } <span style=color:#66d9ef>else</span> {
        $msg <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼&#34;</span>;
    }
}
</code></pre></div><p>ä»£ç é‡‡ç”¨çš„ç™½åå•æ ¡éªŒï¼Œåªå…è®¸ä¸Šä¼ å›¾ç‰‡æ ¼å¼ï¼Œç†è®ºä¸Šè¿™ä¸ªä¸Šä¼ æ˜¯ä¸å¥½ç»•è¿‡çš„ã€‚</p><p>ä½†æ˜¯åé¢é‡‡ç”¨ä¿å­˜æ–‡ä»¶çš„æ—¶å€™ï¼Œæ˜¯è·¯å¾„æ‹¼æ¥çš„å½¢å¼ï¼Œè€Œè·¯å¾„åˆæ˜¯ä»å‰ç«¯è·å–ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨è·¯å¾„ä¸Šåšæ‰‹è„šã€‚</p><p>å¦‚ä¸‹ä¸Šä¼ ï¼Œæ˜¾ç¤ºæ–‡ä»¶è·¯å¾„ä¸­æœ‰ä¸ªç©ºæ ¼ï¼Œè¿™å¹¶ä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„ç©ºæ ¼ï¼Œè€Œæ˜¯%00æˆªæ–­åæ˜¾ç¤ºæˆçš„ç©ºæ ¼ã€‚</p><blockquote><p>åœ¨urlä¸­%00è¡¨ç¤ºascllç ä¸­çš„0 ï¼Œè€Œasciiä¸­0ä½œä¸ºç‰¹æ®Šå­—ç¬¦ä¿ç•™ï¼Œè¡¨ç¤ºå­—ç¬¦ä¸²ç»“æŸï¼Œæ‰€ä»¥å½“urlä¸­å‡ºç°%00æ—¶å°±ä¼šè®¤ä¸ºè¯»å–å·²ç»“æŸ (phpç‰ˆæœ¬è¦å°äº5.3.4ï¼Œ5.3.4åŠä»¥ä¸Šå·²ç»ä¿®å¤è¯¥é—®é¢˜)</p></blockquote></content><p><a href=https://sdttttt.github.io/tags/penetration-test/>#penetration test</a></p></main><footer><script async src=https://comments.app/js/widget.js?3 data-comments-app-website=16l5H9Ux data-limit=5></script><img src=github.png></footer></body></html>