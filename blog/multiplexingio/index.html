<!DOCTYPE html>
<html lang="zh-cn">

<head>
  <meta http-equiv="X-Clacks-Overhead" content="GNU Terry Pratchett" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="shortcut icon" href="https://sdttttt.github.io/favicon.ico" />
<title>MultiplexingIO | SDTTTTT&#39;s Smelly fish Rotten shrimp ğŸ““</title>
<meta name="title" content="MultiplexingIO" />
<meta name="description" content="å…¶å®â€œI/Oå¤šè·¯å¤ç”¨â€è¿™ä¸ªå‘çˆ¹ç¿»è¯‘å¯èƒ½æ˜¯è¿™ä¸ªæ¦‚å¿µåœ¨ä¸­æ–‡é‡Œé¢å¦‚æ­¤éš¾ç†è§£çš„åŸå› ã€‚æ‰€è°“çš„I/Oå¤šè·¯ å¤ç”¨åœ¨è‹±æ–‡ä¸­å…¶å®å« I/O multiplexing. å¦‚æœä½ æœç´¢multiplexingå•¥æ„æ€,åŸºæœ¬ä¸Šéƒ½ä¼šå‡ºè¿™ä¸ªå›¾:
äºæ˜¯å¤§éƒ¨åˆ†äººéƒ½ç›´æ¥è”æƒ³åˆ°&quot;ä¸€æ ¹ç½‘çº¿,å¤šä¸ªsockå¤ç”¨&quot; è¿™ä¸ªæ¦‚å¿µ,åŒ…æ‹¬ä¸Šé¢çš„å‡ ä¸ªå›ç­”, å…¶å®ä¸ ç®¡ä½ ç”¨å¤šè¿›ç¨‹è¿˜æ˜¯I/Oå¤šè·¯å¤ç”¨, ç½‘çº¿éƒ½åªæœ‰ä¸€æ ¹å¥½ä¼ã€‚å¤šä¸ªSockå¤ç”¨ä¸€æ ¹ç½‘çº¿è¿™ä¸ªåŠŸèƒ½æ˜¯åœ¨å†…æ ¸ &#43;é©±åŠ¨å±‚å®ç°çš„.
é‡è¦çš„äº‹æƒ…å†è¯´ä¸€é: I/O multiplexing è¿™é‡Œé¢çš„ multiplexing æŒ‡çš„å…¶å®æ˜¯åœ¨å•ä¸ªçº¿ç¨‹é€šè¿‡è®° å½•è·Ÿè¸ªæ¯ä¸€ä¸ªSock(I/Oæµ)çš„çŠ¶æ€(å¯¹åº”ç©ºç®¡å¡”é‡Œé¢çš„Fight progress stripæ§½)æ¥åŒæ—¶ç®¡ç†å¤šä¸ªI/O æµ. å‘æ˜å®ƒçš„åŸå› ,æ˜¯å°½é‡å¤šçš„æé«˜æœåŠ¡å™¨çš„ååèƒ½åŠ›ã€‚
æ˜¯ä¸æ˜¯å¬èµ·æ¥å¥½æ‹—å£,çœ‹ä¸ªå›¾å°±æ‡‚äº†.
åœ¨åŒä¸€ä¸ªçº¿ç¨‹é‡Œé¢, é€šè¿‡æ‹¨å¼€å…³çš„æ–¹å¼,æ¥åŒæ—¶ä¼ è¾“å¤šä¸ªI/Oæµ, (å­¦è¿‡EEçš„äººç°åœ¨å¯ä»¥ç«™å‡ºæ¥ä¹‰æ­£ ä¸¥è¾è¯´è¿™ä¸ªå«â€œæ—¶åˆ†å¤ç”¨â€äº†)ã€‚
ä»€ä¹ˆ,ä½ è¿˜æ²¡æœ‰ææ‡‚ â€œä¸€ä¸ªè¯·æ±‚åˆ°æ¥äº†,nginxä½¿ç”¨epollæ¥æ”¶è¯·æ±‚çš„è¿‡ç¨‹æ˜¯æ€æ ·çš„â€, å¤šçœ‹çœ‹è¿™ä¸ª å›¾å°±äº†è§£äº†ã€‚æé†’ä¸‹,ngnixä¼šæœ‰å¾ˆå¤šé“¾æ¥è¿›æ¥, epollä¼šæŠŠä»–ä»¬éƒ½ç›‘è§†èµ·æ¥,ç„¶ååƒæ‹¨å¼€å…³ä¸€æ ·, è°æœ‰æ•°æ®å°±æ‹¨å‘è°,ç„¶åè°ƒç”¨ç›¸åº”çš„ä»£ç å¤„ç†ã€‚
 äº†è§£è¿™ä¸ªåŸºæœ¬çš„æ¦‚å¿µä»¥å,å…¶ä»–çš„å°±å¾ˆå¥½è§£é‡Šäº†ã€‚
select, poll, epoll éƒ½æ˜¯I/Oå¤šè·¯å¤ç”¨çš„å…·ä½“çš„å®ç°,ä¹‹æ‰€ä»¥æœ‰è¿™ä¸‰ä¸ªé¬¼å­˜åœ¨,å…¶å®æ˜¯ä»–ä»¬å‡ºç°æ˜¯æœ‰ å…ˆåé¡ºåºçš„ã€‚
I/Oå¤šè·¯å¤ç”¨è¿™ä¸ªæ¦‚å¿µè¢«æå‡ºæ¥ä»¥å, selectæ˜¯ç¬¬ä¸€ä¸ªå®ç° (1983 å·¦å³åœ¨BSDé‡Œé¢å®ç°çš„)ã€‚
select è¢«å®ç°ä»¥å,å¾ˆå¿«å°±æš´éœ²å‡ºäº†å¾ˆå¤šé—®é¢˜ã€‚
 select ä¼šä¿®æ”¹ä¼ å…¥çš„å‚æ•°æ•°ç»„,è¿™ä¸ªå¯¹äºä¸€ä¸ªéœ€è¦è°ƒç”¨å¾ˆå¤šæ¬¡çš„å‡½æ•°,æ˜¯éå¸¸ä¸å‹å¥½çš„ã€‚ select å¦‚æœä»»ä½•ä¸€ä¸ªsock(I/O stream)å‡ºç°äº†æ•°æ®,select ä»…ä»…ä¼šè¿”å›,ä½†æ˜¯å¹¶ä¸ä¼šå‘Šè¯‰ä½ æ˜¯é‚£ ä¸ªsockä¸Šæœ‰æ•°æ®,äºæ˜¯ä½ åªèƒ½è‡ªå·±ä¸€ä¸ªä¸€ä¸ªçš„æ‰¾,10å‡ ä¸ªsockå¯èƒ½è¿˜å¥½,è¦æ˜¯å‡ ä¸‡çš„sockæ¯æ¬¡ select ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„,å¦‚æœä½ æŠŠä¸€ä¸ªsockåŠ å…¥åˆ°select, ç„¶åçªç„¶å¦å¤–ä¸€ä¸ªçº¿ç¨‹å‘ç°,å°¼ç›,è¿™ ä¸ªsockä¸ç”¨,è¦æ”¶å›ã€‚å¯¹ä¸èµ·,è¿™ä¸ªselect ä¸æ”¯æŒçš„,å¦‚æœä½ ä¸§å¿ƒç—…ç‹‚çš„ç«Ÿç„¶å…³æ‰è¿™ä¸ªsock, selectçš„æ ‡å‡†è¡Œä¸ºæ˜¯ã€‚ã€‚å‘ƒã€‚ã€‚ä¸å¯é¢„æµ‹çš„, è¿™ä¸ªå¯æ˜¯å†™åœ¨æ–‡æ¡£ä¸­çš„å“¦.   â€œIf a file descriptor being monitored by select() is closed in another thread, the result is unspecified." />
<meta name="keywords" content="unix," />


<meta property="og:title" content="MultiplexingIO" />
<meta property="og:description" content="å…¶å®â€œI/Oå¤šè·¯å¤ç”¨â€è¿™ä¸ªå‘çˆ¹ç¿»è¯‘å¯èƒ½æ˜¯è¿™ä¸ªæ¦‚å¿µåœ¨ä¸­æ–‡é‡Œé¢å¦‚æ­¤éš¾ç†è§£çš„åŸå› ã€‚æ‰€è°“çš„I/Oå¤šè·¯ å¤ç”¨åœ¨è‹±æ–‡ä¸­å…¶å®å« I/O multiplexing. å¦‚æœä½ æœç´¢multiplexingå•¥æ„æ€,åŸºæœ¬ä¸Šéƒ½ä¼šå‡ºè¿™ä¸ªå›¾:
äºæ˜¯å¤§éƒ¨åˆ†äººéƒ½ç›´æ¥è”æƒ³åˆ°&quot;ä¸€æ ¹ç½‘çº¿,å¤šä¸ªsockå¤ç”¨&quot; è¿™ä¸ªæ¦‚å¿µ,åŒ…æ‹¬ä¸Šé¢çš„å‡ ä¸ªå›ç­”, å…¶å®ä¸ ç®¡ä½ ç”¨å¤šè¿›ç¨‹è¿˜æ˜¯I/Oå¤šè·¯å¤ç”¨, ç½‘çº¿éƒ½åªæœ‰ä¸€æ ¹å¥½ä¼ã€‚å¤šä¸ªSockå¤ç”¨ä¸€æ ¹ç½‘çº¿è¿™ä¸ªåŠŸèƒ½æ˜¯åœ¨å†…æ ¸ &#43;é©±åŠ¨å±‚å®ç°çš„.
é‡è¦çš„äº‹æƒ…å†è¯´ä¸€é: I/O multiplexing è¿™é‡Œé¢çš„ multiplexing æŒ‡çš„å…¶å®æ˜¯åœ¨å•ä¸ªçº¿ç¨‹é€šè¿‡è®° å½•è·Ÿè¸ªæ¯ä¸€ä¸ªSock(I/Oæµ)çš„çŠ¶æ€(å¯¹åº”ç©ºç®¡å¡”é‡Œé¢çš„Fight progress stripæ§½)æ¥åŒæ—¶ç®¡ç†å¤šä¸ªI/O æµ. å‘æ˜å®ƒçš„åŸå› ,æ˜¯å°½é‡å¤šçš„æé«˜æœåŠ¡å™¨çš„ååèƒ½åŠ›ã€‚
æ˜¯ä¸æ˜¯å¬èµ·æ¥å¥½æ‹—å£,çœ‹ä¸ªå›¾å°±æ‡‚äº†.
åœ¨åŒä¸€ä¸ªçº¿ç¨‹é‡Œé¢, é€šè¿‡æ‹¨å¼€å…³çš„æ–¹å¼,æ¥åŒæ—¶ä¼ è¾“å¤šä¸ªI/Oæµ, (å­¦è¿‡EEçš„äººç°åœ¨å¯ä»¥ç«™å‡ºæ¥ä¹‰æ­£ ä¸¥è¾è¯´è¿™ä¸ªå«â€œæ—¶åˆ†å¤ç”¨â€äº†)ã€‚
ä»€ä¹ˆ,ä½ è¿˜æ²¡æœ‰ææ‡‚ â€œä¸€ä¸ªè¯·æ±‚åˆ°æ¥äº†,nginxä½¿ç”¨epollæ¥æ”¶è¯·æ±‚çš„è¿‡ç¨‹æ˜¯æ€æ ·çš„â€, å¤šçœ‹çœ‹è¿™ä¸ª å›¾å°±äº†è§£äº†ã€‚æé†’ä¸‹,ngnixä¼šæœ‰å¾ˆå¤šé“¾æ¥è¿›æ¥, epollä¼šæŠŠä»–ä»¬éƒ½ç›‘è§†èµ·æ¥,ç„¶ååƒæ‹¨å¼€å…³ä¸€æ ·, è°æœ‰æ•°æ®å°±æ‹¨å‘è°,ç„¶åè°ƒç”¨ç›¸åº”çš„ä»£ç å¤„ç†ã€‚
 äº†è§£è¿™ä¸ªåŸºæœ¬çš„æ¦‚å¿µä»¥å,å…¶ä»–çš„å°±å¾ˆå¥½è§£é‡Šäº†ã€‚
select, poll, epoll éƒ½æ˜¯I/Oå¤šè·¯å¤ç”¨çš„å…·ä½“çš„å®ç°,ä¹‹æ‰€ä»¥æœ‰è¿™ä¸‰ä¸ªé¬¼å­˜åœ¨,å…¶å®æ˜¯ä»–ä»¬å‡ºç°æ˜¯æœ‰ å…ˆåé¡ºåºçš„ã€‚
I/Oå¤šè·¯å¤ç”¨è¿™ä¸ªæ¦‚å¿µè¢«æå‡ºæ¥ä»¥å, selectæ˜¯ç¬¬ä¸€ä¸ªå®ç° (1983 å·¦å³åœ¨BSDé‡Œé¢å®ç°çš„)ã€‚
select è¢«å®ç°ä»¥å,å¾ˆå¿«å°±æš´éœ²å‡ºäº†å¾ˆå¤šé—®é¢˜ã€‚
 select ä¼šä¿®æ”¹ä¼ å…¥çš„å‚æ•°æ•°ç»„,è¿™ä¸ªå¯¹äºä¸€ä¸ªéœ€è¦è°ƒç”¨å¾ˆå¤šæ¬¡çš„å‡½æ•°,æ˜¯éå¸¸ä¸å‹å¥½çš„ã€‚ select å¦‚æœä»»ä½•ä¸€ä¸ªsock(I/O stream)å‡ºç°äº†æ•°æ®,select ä»…ä»…ä¼šè¿”å›,ä½†æ˜¯å¹¶ä¸ä¼šå‘Šè¯‰ä½ æ˜¯é‚£ ä¸ªsockä¸Šæœ‰æ•°æ®,äºæ˜¯ä½ åªèƒ½è‡ªå·±ä¸€ä¸ªä¸€ä¸ªçš„æ‰¾,10å‡ ä¸ªsockå¯èƒ½è¿˜å¥½,è¦æ˜¯å‡ ä¸‡çš„sockæ¯æ¬¡ select ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„,å¦‚æœä½ æŠŠä¸€ä¸ªsockåŠ å…¥åˆ°select, ç„¶åçªç„¶å¦å¤–ä¸€ä¸ªçº¿ç¨‹å‘ç°,å°¼ç›,è¿™ ä¸ªsockä¸ç”¨,è¦æ”¶å›ã€‚å¯¹ä¸èµ·,è¿™ä¸ªselect ä¸æ”¯æŒçš„,å¦‚æœä½ ä¸§å¿ƒç—…ç‹‚çš„ç«Ÿç„¶å…³æ‰è¿™ä¸ªsock, selectçš„æ ‡å‡†è¡Œä¸ºæ˜¯ã€‚ã€‚å‘ƒã€‚ã€‚ä¸å¯é¢„æµ‹çš„, è¿™ä¸ªå¯æ˜¯å†™åœ¨æ–‡æ¡£ä¸­çš„å“¦.   â€œIf a file descriptor being monitored by select() is closed in another thread, the result is unspecified." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://sdttttt.github.io/blog/multiplexingio/" />
<meta property="og:image" content="https://sdttttt.github.io/me.jpg"/>
<meta property="article:published_time" content="2020-04-06T12:42:26+08:00" />
<meta property="article:modified_time" content="2020-04-06T12:42:26+08:00" /><meta property="og:site_name" content="SDTTTTT" />



<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://sdttttt.github.io/me.jpg"/>

<meta name="twitter:title" content="MultiplexingIO"/>
<meta name="twitter:description" content="å…¶å®â€œI/Oå¤šè·¯å¤ç”¨â€è¿™ä¸ªå‘çˆ¹ç¿»è¯‘å¯èƒ½æ˜¯è¿™ä¸ªæ¦‚å¿µåœ¨ä¸­æ–‡é‡Œé¢å¦‚æ­¤éš¾ç†è§£çš„åŸå› ã€‚æ‰€è°“çš„I/Oå¤šè·¯ å¤ç”¨åœ¨è‹±æ–‡ä¸­å…¶å®å« I/O multiplexing. å¦‚æœä½ æœç´¢multiplexingå•¥æ„æ€,åŸºæœ¬ä¸Šéƒ½ä¼šå‡ºè¿™ä¸ªå›¾:
äºæ˜¯å¤§éƒ¨åˆ†äººéƒ½ç›´æ¥è”æƒ³åˆ°&quot;ä¸€æ ¹ç½‘çº¿,å¤šä¸ªsockå¤ç”¨&quot; è¿™ä¸ªæ¦‚å¿µ,åŒ…æ‹¬ä¸Šé¢çš„å‡ ä¸ªå›ç­”, å…¶å®ä¸ ç®¡ä½ ç”¨å¤šè¿›ç¨‹è¿˜æ˜¯I/Oå¤šè·¯å¤ç”¨, ç½‘çº¿éƒ½åªæœ‰ä¸€æ ¹å¥½ä¼ã€‚å¤šä¸ªSockå¤ç”¨ä¸€æ ¹ç½‘çº¿è¿™ä¸ªåŠŸèƒ½æ˜¯åœ¨å†…æ ¸ &#43;é©±åŠ¨å±‚å®ç°çš„.
é‡è¦çš„äº‹æƒ…å†è¯´ä¸€é: I/O multiplexing è¿™é‡Œé¢çš„ multiplexing æŒ‡çš„å…¶å®æ˜¯åœ¨å•ä¸ªçº¿ç¨‹é€šè¿‡è®° å½•è·Ÿè¸ªæ¯ä¸€ä¸ªSock(I/Oæµ)çš„çŠ¶æ€(å¯¹åº”ç©ºç®¡å¡”é‡Œé¢çš„Fight progress stripæ§½)æ¥åŒæ—¶ç®¡ç†å¤šä¸ªI/O æµ. å‘æ˜å®ƒçš„åŸå› ,æ˜¯å°½é‡å¤šçš„æé«˜æœåŠ¡å™¨çš„ååèƒ½åŠ›ã€‚
æ˜¯ä¸æ˜¯å¬èµ·æ¥å¥½æ‹—å£,çœ‹ä¸ªå›¾å°±æ‡‚äº†.
åœ¨åŒä¸€ä¸ªçº¿ç¨‹é‡Œé¢, é€šè¿‡æ‹¨å¼€å…³çš„æ–¹å¼,æ¥åŒæ—¶ä¼ è¾“å¤šä¸ªI/Oæµ, (å­¦è¿‡EEçš„äººç°åœ¨å¯ä»¥ç«™å‡ºæ¥ä¹‰æ­£ ä¸¥è¾è¯´è¿™ä¸ªå«â€œæ—¶åˆ†å¤ç”¨â€äº†)ã€‚
ä»€ä¹ˆ,ä½ è¿˜æ²¡æœ‰ææ‡‚ â€œä¸€ä¸ªè¯·æ±‚åˆ°æ¥äº†,nginxä½¿ç”¨epollæ¥æ”¶è¯·æ±‚çš„è¿‡ç¨‹æ˜¯æ€æ ·çš„â€, å¤šçœ‹çœ‹è¿™ä¸ª å›¾å°±äº†è§£äº†ã€‚æé†’ä¸‹,ngnixä¼šæœ‰å¾ˆå¤šé“¾æ¥è¿›æ¥, epollä¼šæŠŠä»–ä»¬éƒ½ç›‘è§†èµ·æ¥,ç„¶ååƒæ‹¨å¼€å…³ä¸€æ ·, è°æœ‰æ•°æ®å°±æ‹¨å‘è°,ç„¶åè°ƒç”¨ç›¸åº”çš„ä»£ç å¤„ç†ã€‚
 äº†è§£è¿™ä¸ªåŸºæœ¬çš„æ¦‚å¿µä»¥å,å…¶ä»–çš„å°±å¾ˆå¥½è§£é‡Šäº†ã€‚
select, poll, epoll éƒ½æ˜¯I/Oå¤šè·¯å¤ç”¨çš„å…·ä½“çš„å®ç°,ä¹‹æ‰€ä»¥æœ‰è¿™ä¸‰ä¸ªé¬¼å­˜åœ¨,å…¶å®æ˜¯ä»–ä»¬å‡ºç°æ˜¯æœ‰ å…ˆåé¡ºåºçš„ã€‚
I/Oå¤šè·¯å¤ç”¨è¿™ä¸ªæ¦‚å¿µè¢«æå‡ºæ¥ä»¥å, selectæ˜¯ç¬¬ä¸€ä¸ªå®ç° (1983 å·¦å³åœ¨BSDé‡Œé¢å®ç°çš„)ã€‚
select è¢«å®ç°ä»¥å,å¾ˆå¿«å°±æš´éœ²å‡ºäº†å¾ˆå¤šé—®é¢˜ã€‚
 select ä¼šä¿®æ”¹ä¼ å…¥çš„å‚æ•°æ•°ç»„,è¿™ä¸ªå¯¹äºä¸€ä¸ªéœ€è¦è°ƒç”¨å¾ˆå¤šæ¬¡çš„å‡½æ•°,æ˜¯éå¸¸ä¸å‹å¥½çš„ã€‚ select å¦‚æœä»»ä½•ä¸€ä¸ªsock(I/O stream)å‡ºç°äº†æ•°æ®,select ä»…ä»…ä¼šè¿”å›,ä½†æ˜¯å¹¶ä¸ä¼šå‘Šè¯‰ä½ æ˜¯é‚£ ä¸ªsockä¸Šæœ‰æ•°æ®,äºæ˜¯ä½ åªèƒ½è‡ªå·±ä¸€ä¸ªä¸€ä¸ªçš„æ‰¾,10å‡ ä¸ªsockå¯èƒ½è¿˜å¥½,è¦æ˜¯å‡ ä¸‡çš„sockæ¯æ¬¡ select ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„,å¦‚æœä½ æŠŠä¸€ä¸ªsockåŠ å…¥åˆ°select, ç„¶åçªç„¶å¦å¤–ä¸€ä¸ªçº¿ç¨‹å‘ç°,å°¼ç›,è¿™ ä¸ªsockä¸ç”¨,è¦æ”¶å›ã€‚å¯¹ä¸èµ·,è¿™ä¸ªselect ä¸æ”¯æŒçš„,å¦‚æœä½ ä¸§å¿ƒç—…ç‹‚çš„ç«Ÿç„¶å…³æ‰è¿™ä¸ªsock, selectçš„æ ‡å‡†è¡Œä¸ºæ˜¯ã€‚ã€‚å‘ƒã€‚ã€‚ä¸å¯é¢„æµ‹çš„, è¿™ä¸ªå¯æ˜¯å†™åœ¨æ–‡æ¡£ä¸­çš„å“¦.   â€œIf a file descriptor being monitored by select() is closed in another thread, the result is unspecified."/>



<meta itemprop="name" content="MultiplexingIO">
<meta itemprop="description" content="å…¶å®â€œI/Oå¤šè·¯å¤ç”¨â€è¿™ä¸ªå‘çˆ¹ç¿»è¯‘å¯èƒ½æ˜¯è¿™ä¸ªæ¦‚å¿µåœ¨ä¸­æ–‡é‡Œé¢å¦‚æ­¤éš¾ç†è§£çš„åŸå› ã€‚æ‰€è°“çš„I/Oå¤šè·¯ å¤ç”¨åœ¨è‹±æ–‡ä¸­å…¶å®å« I/O multiplexing. å¦‚æœä½ æœç´¢multiplexingå•¥æ„æ€,åŸºæœ¬ä¸Šéƒ½ä¼šå‡ºè¿™ä¸ªå›¾:
äºæ˜¯å¤§éƒ¨åˆ†äººéƒ½ç›´æ¥è”æƒ³åˆ°&quot;ä¸€æ ¹ç½‘çº¿,å¤šä¸ªsockå¤ç”¨&quot; è¿™ä¸ªæ¦‚å¿µ,åŒ…æ‹¬ä¸Šé¢çš„å‡ ä¸ªå›ç­”, å…¶å®ä¸ ç®¡ä½ ç”¨å¤šè¿›ç¨‹è¿˜æ˜¯I/Oå¤šè·¯å¤ç”¨, ç½‘çº¿éƒ½åªæœ‰ä¸€æ ¹å¥½ä¼ã€‚å¤šä¸ªSockå¤ç”¨ä¸€æ ¹ç½‘çº¿è¿™ä¸ªåŠŸèƒ½æ˜¯åœ¨å†…æ ¸ &#43;é©±åŠ¨å±‚å®ç°çš„.
é‡è¦çš„äº‹æƒ…å†è¯´ä¸€é: I/O multiplexing è¿™é‡Œé¢çš„ multiplexing æŒ‡çš„å…¶å®æ˜¯åœ¨å•ä¸ªçº¿ç¨‹é€šè¿‡è®° å½•è·Ÿè¸ªæ¯ä¸€ä¸ªSock(I/Oæµ)çš„çŠ¶æ€(å¯¹åº”ç©ºç®¡å¡”é‡Œé¢çš„Fight progress stripæ§½)æ¥åŒæ—¶ç®¡ç†å¤šä¸ªI/O æµ. å‘æ˜å®ƒçš„åŸå› ,æ˜¯å°½é‡å¤šçš„æé«˜æœåŠ¡å™¨çš„ååèƒ½åŠ›ã€‚
æ˜¯ä¸æ˜¯å¬èµ·æ¥å¥½æ‹—å£,çœ‹ä¸ªå›¾å°±æ‡‚äº†.
åœ¨åŒä¸€ä¸ªçº¿ç¨‹é‡Œé¢, é€šè¿‡æ‹¨å¼€å…³çš„æ–¹å¼,æ¥åŒæ—¶ä¼ è¾“å¤šä¸ªI/Oæµ, (å­¦è¿‡EEçš„äººç°åœ¨å¯ä»¥ç«™å‡ºæ¥ä¹‰æ­£ ä¸¥è¾è¯´è¿™ä¸ªå«â€œæ—¶åˆ†å¤ç”¨â€äº†)ã€‚
ä»€ä¹ˆ,ä½ è¿˜æ²¡æœ‰ææ‡‚ â€œä¸€ä¸ªè¯·æ±‚åˆ°æ¥äº†,nginxä½¿ç”¨epollæ¥æ”¶è¯·æ±‚çš„è¿‡ç¨‹æ˜¯æ€æ ·çš„â€, å¤šçœ‹çœ‹è¿™ä¸ª å›¾å°±äº†è§£äº†ã€‚æé†’ä¸‹,ngnixä¼šæœ‰å¾ˆå¤šé“¾æ¥è¿›æ¥, epollä¼šæŠŠä»–ä»¬éƒ½ç›‘è§†èµ·æ¥,ç„¶ååƒæ‹¨å¼€å…³ä¸€æ ·, è°æœ‰æ•°æ®å°±æ‹¨å‘è°,ç„¶åè°ƒç”¨ç›¸åº”çš„ä»£ç å¤„ç†ã€‚
 äº†è§£è¿™ä¸ªåŸºæœ¬çš„æ¦‚å¿µä»¥å,å…¶ä»–çš„å°±å¾ˆå¥½è§£é‡Šäº†ã€‚
select, poll, epoll éƒ½æ˜¯I/Oå¤šè·¯å¤ç”¨çš„å…·ä½“çš„å®ç°,ä¹‹æ‰€ä»¥æœ‰è¿™ä¸‰ä¸ªé¬¼å­˜åœ¨,å…¶å®æ˜¯ä»–ä»¬å‡ºç°æ˜¯æœ‰ å…ˆåé¡ºåºçš„ã€‚
I/Oå¤šè·¯å¤ç”¨è¿™ä¸ªæ¦‚å¿µè¢«æå‡ºæ¥ä»¥å, selectæ˜¯ç¬¬ä¸€ä¸ªå®ç° (1983 å·¦å³åœ¨BSDé‡Œé¢å®ç°çš„)ã€‚
select è¢«å®ç°ä»¥å,å¾ˆå¿«å°±æš´éœ²å‡ºäº†å¾ˆå¤šé—®é¢˜ã€‚
 select ä¼šä¿®æ”¹ä¼ å…¥çš„å‚æ•°æ•°ç»„,è¿™ä¸ªå¯¹äºä¸€ä¸ªéœ€è¦è°ƒç”¨å¾ˆå¤šæ¬¡çš„å‡½æ•°,æ˜¯éå¸¸ä¸å‹å¥½çš„ã€‚ select å¦‚æœä»»ä½•ä¸€ä¸ªsock(I/O stream)å‡ºç°äº†æ•°æ®,select ä»…ä»…ä¼šè¿”å›,ä½†æ˜¯å¹¶ä¸ä¼šå‘Šè¯‰ä½ æ˜¯é‚£ ä¸ªsockä¸Šæœ‰æ•°æ®,äºæ˜¯ä½ åªèƒ½è‡ªå·±ä¸€ä¸ªä¸€ä¸ªçš„æ‰¾,10å‡ ä¸ªsockå¯èƒ½è¿˜å¥½,è¦æ˜¯å‡ ä¸‡çš„sockæ¯æ¬¡ select ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„,å¦‚æœä½ æŠŠä¸€ä¸ªsockåŠ å…¥åˆ°select, ç„¶åçªç„¶å¦å¤–ä¸€ä¸ªçº¿ç¨‹å‘ç°,å°¼ç›,è¿™ ä¸ªsockä¸ç”¨,è¦æ”¶å›ã€‚å¯¹ä¸èµ·,è¿™ä¸ªselect ä¸æ”¯æŒçš„,å¦‚æœä½ ä¸§å¿ƒç—…ç‹‚çš„ç«Ÿç„¶å…³æ‰è¿™ä¸ªsock, selectçš„æ ‡å‡†è¡Œä¸ºæ˜¯ã€‚ã€‚å‘ƒã€‚ã€‚ä¸å¯é¢„æµ‹çš„, è¿™ä¸ªå¯æ˜¯å†™åœ¨æ–‡æ¡£ä¸­çš„å“¦.   â€œIf a file descriptor being monitored by select() is closed in another thread, the result is unspecified.">
<meta itemprop="datePublished" content="2020-04-06T12:42:26+08:00" />
<meta itemprop="dateModified" content="2020-04-06T12:42:26+08:00" />
<meta itemprop="wordCount" content="112">
<meta itemprop="image" content="https://sdttttt.github.io/me.jpg"/>



<meta itemprop="keywords" content="unix," />

<meta name="referrer" content="no-referrer-when-downgrade" />

  <style>
  body {
    font-family: Verdana, sans-serif;
    margin: auto;
    padding: 20px;
    max-width: 720px;
    text-align: left;
    background-color: #fff;
    word-wrap: break-word;
    overflow-wrap: break-word;
    line-height: 1.5;
    color: #444;
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6,
  strong,
  b {
    color: #222;
  }

  a {
    color: #3273dc;
     
  }

  .title {
    text-decoration: none;
    border: 0;
  }

  .title span {
    font-weight: 400;
  }

  nav a {
    margin-right: 10px;
  }

  textarea {
    width: 100%;
    font-size: 16px;
  }

  input {
    font-size: 16px;
  }

  content {
    line-height: 1.6;
  }

  table {
    width: 100%;
  }

  img {
    max-width: 100%;
  }

  code {
    padding: 2px 5px;
    background-color: #f2f2f2;
  }

  pre code {
    color: #222;
    display: block;
    padding: 20px;
    white-space: pre-wrap;
    font-size: 14px;
  }

  blockquote {
    border-left: 1px solid #999;
    color: #222;
    padding-left: 20px;
    font-style: italic;
  }

  footer {
    padding: 25px;
    text-align: center;
  }

  .helptext {
    color: #777;
    font-size: small;
  }

  .errorlist {
    color: #eba613;
    font-size: small;
  }

   
  ul.blog-posts {
    list-style-type: none;
    padding: unset;
  }

  ul.blog-posts li {
    display: flex;
  }

  ul.blog-posts li span {
    flex: 0 0 130px;
  }

  ul.blog-posts li a:visited {
    color: #8b6fcb;
  }

  @media (prefers-color-scheme: dark) {
    body {
      background-color: #333;
      color: #ddd;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6,
    strong,
    b {
      color: #eee;
    }

    a {
      color: #8cc2dd;
    }

    code {
      background-color: #777;
    }

    pre code {
      color: #ddd;
    }

    blockquote {
      color: #ccc;
    }

    textarea,
    input {
      background-color: #252525;
      color: #ddd;
    }

    .helptext {
      color: #aaa;
    }
  }

</style>

</head>

<body>
  <header><a href="/" class="title">
  <h2>SDTTTTT&#39;s Smelly fish Rotten shrimp ğŸ““</h2>
</a>
<nav><a href="/">Home</a>


<a href="/blog">Blog</a>

</nav>
</header>
  <main>

<h1>MultiplexingIO</h1>
<p>
  <i>
    <time datetime='2020-04-06' pubdate>
      06 Apr, 2020
    </time>
  </i>
</p>

<content>
  <p>å…¶å®â€œI/Oå¤šè·¯å¤ç”¨â€è¿™ä¸ªå‘çˆ¹ç¿»è¯‘å¯èƒ½æ˜¯è¿™ä¸ªæ¦‚å¿µåœ¨ä¸­æ–‡é‡Œé¢å¦‚æ­¤éš¾ç†è§£çš„åŸå› ã€‚æ‰€è°“çš„I/Oå¤šè·¯
å¤ç”¨åœ¨è‹±æ–‡ä¸­å…¶å®å« I/O multiplexing. å¦‚æœä½ æœç´¢multiplexingå•¥æ„æ€,åŸºæœ¬ä¸Šéƒ½ä¼šå‡ºè¿™ä¸ªå›¾:</p>
<p><img src="/multiplexIO/1.png" alt=""></p>
<p>äºæ˜¯å¤§éƒ¨åˆ†äººéƒ½ç›´æ¥è”æƒ³åˆ°&quot;ä¸€æ ¹ç½‘çº¿,å¤šä¸ªsockå¤ç”¨&quot; è¿™ä¸ªæ¦‚å¿µ,åŒ…æ‹¬ä¸Šé¢çš„å‡ ä¸ªå›ç­”, å…¶å®ä¸
ç®¡ä½ ç”¨å¤šè¿›ç¨‹è¿˜æ˜¯I/Oå¤šè·¯å¤ç”¨, ç½‘çº¿éƒ½åªæœ‰ä¸€æ ¹å¥½ä¼ã€‚<strong>å¤šä¸ªSockå¤ç”¨ä¸€æ ¹ç½‘çº¿è¿™ä¸ªåŠŸèƒ½æ˜¯åœ¨å†…æ ¸
+é©±åŠ¨å±‚å®ç°çš„.</strong></p>
<p><strong>é‡è¦çš„äº‹æƒ…å†è¯´ä¸€é: I/O multiplexing è¿™é‡Œé¢çš„ multiplexing æŒ‡çš„å…¶å®æ˜¯åœ¨å•ä¸ªçº¿ç¨‹é€šè¿‡è®°
å½•è·Ÿè¸ªæ¯ä¸€ä¸ªSock(I/Oæµ)çš„çŠ¶æ€(å¯¹åº”ç©ºç®¡å¡”é‡Œé¢çš„Fight progress stripæ§½)æ¥åŒæ—¶ç®¡ç†å¤šä¸ªI/O
æµ.</strong> å‘æ˜å®ƒçš„åŸå› ,æ˜¯å°½é‡å¤šçš„æé«˜æœåŠ¡å™¨çš„ååèƒ½åŠ›ã€‚</p>
<p>æ˜¯ä¸æ˜¯å¬èµ·æ¥å¥½æ‹—å£,çœ‹ä¸ªå›¾å°±æ‡‚äº†.</p>
<p><img src="/multiplexIO/2.png" alt=""></p>
<p>åœ¨åŒä¸€ä¸ªçº¿ç¨‹é‡Œé¢, é€šè¿‡æ‹¨å¼€å…³çš„æ–¹å¼,æ¥åŒæ—¶ä¼ è¾“å¤šä¸ªI/Oæµ, (å­¦è¿‡EEçš„äººç°åœ¨å¯ä»¥ç«™å‡ºæ¥ä¹‰æ­£
ä¸¥è¾è¯´è¿™ä¸ªå«â€œæ—¶åˆ†å¤ç”¨â€äº†)ã€‚</p>
<p>ä»€ä¹ˆ,ä½ è¿˜æ²¡æœ‰ææ‡‚ â€œä¸€ä¸ªè¯·æ±‚åˆ°æ¥äº†,nginxä½¿ç”¨epollæ¥æ”¶è¯·æ±‚çš„è¿‡ç¨‹æ˜¯æ€æ ·çš„â€, å¤šçœ‹çœ‹è¿™ä¸ª
å›¾å°±äº†è§£äº†ã€‚æé†’ä¸‹,ngnixä¼šæœ‰å¾ˆå¤šé“¾æ¥è¿›æ¥, epollä¼šæŠŠä»–ä»¬éƒ½ç›‘è§†èµ·æ¥,ç„¶ååƒæ‹¨å¼€å…³ä¸€æ ·,
è°æœ‰æ•°æ®å°±æ‹¨å‘è°,ç„¶åè°ƒç”¨ç›¸åº”çš„ä»£ç å¤„ç†ã€‚</p>
<hr>
<p>äº†è§£è¿™ä¸ªåŸºæœ¬çš„æ¦‚å¿µä»¥å,å…¶ä»–çš„å°±å¾ˆå¥½è§£é‡Šäº†ã€‚</p>
<p><strong>select, poll, epoll éƒ½æ˜¯I/Oå¤šè·¯å¤ç”¨çš„å…·ä½“çš„å®ç°,ä¹‹æ‰€ä»¥æœ‰è¿™ä¸‰ä¸ªé¬¼å­˜åœ¨,å…¶å®æ˜¯ä»–ä»¬å‡ºç°æ˜¯æœ‰
å…ˆåé¡ºåºçš„ã€‚</strong></p>
<p>I/Oå¤šè·¯å¤ç”¨è¿™ä¸ªæ¦‚å¿µè¢«æå‡ºæ¥ä»¥å, selectæ˜¯ç¬¬ä¸€ä¸ªå®ç° (1983 å·¦å³åœ¨BSDé‡Œé¢å®ç°çš„)ã€‚</p>
<p>select è¢«å®ç°ä»¥å,å¾ˆå¿«å°±æš´éœ²å‡ºäº†å¾ˆå¤šé—®é¢˜ã€‚</p>
<ul>
<li>select ä¼šä¿®æ”¹ä¼ å…¥çš„å‚æ•°æ•°ç»„,è¿™ä¸ªå¯¹äºä¸€ä¸ªéœ€è¦è°ƒç”¨å¾ˆå¤šæ¬¡çš„å‡½æ•°,æ˜¯éå¸¸ä¸å‹å¥½çš„ã€‚</li>
<li>select å¦‚æœä»»ä½•ä¸€ä¸ªsock(I/O stream)å‡ºç°äº†æ•°æ®,select ä»…ä»…ä¼šè¿”å›,ä½†æ˜¯å¹¶ä¸ä¼šå‘Šè¯‰ä½ æ˜¯é‚£
ä¸ªsockä¸Šæœ‰æ•°æ®,äºæ˜¯ä½ åªèƒ½è‡ªå·±ä¸€ä¸ªä¸€ä¸ªçš„æ‰¾,10å‡ ä¸ªsockå¯èƒ½è¿˜å¥½,è¦æ˜¯å‡ ä¸‡çš„sockæ¯æ¬¡</li>
<li>select ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„,å¦‚æœä½ æŠŠä¸€ä¸ªsockåŠ å…¥åˆ°select, ç„¶åçªç„¶å¦å¤–ä¸€ä¸ªçº¿ç¨‹å‘ç°,å°¼ç›,è¿™
ä¸ªsockä¸ç”¨,è¦æ”¶å›ã€‚å¯¹ä¸èµ·,è¿™ä¸ªselect ä¸æ”¯æŒçš„,å¦‚æœä½ ä¸§å¿ƒç—…ç‹‚çš„ç«Ÿç„¶å…³æ‰è¿™ä¸ªsock,
selectçš„æ ‡å‡†è¡Œä¸ºæ˜¯ã€‚ã€‚å‘ƒã€‚ã€‚ä¸å¯é¢„æµ‹çš„, è¿™ä¸ªå¯æ˜¯å†™åœ¨æ–‡æ¡£ä¸­çš„å“¦.</li>
</ul>
<blockquote>
<p>â€œIf a file descriptor being monitored by select() is closed in another thread, the result is
unspecified.â€</p>
</blockquote>
<p>äºæ˜¯14å¹´ä»¥å(1997å¹´)ä¸€å¸®äººåˆå®ç°äº†poll, poll ä¿®å¤äº†selectçš„å¾ˆå¤šé—®é¢˜,æ¯”å¦‚:</p>
<ul>
<li>poll å»æ‰äº†1024ä¸ªé“¾æ¥çš„é™åˆ¶,äºæ˜¯è¦å¤šå°‘é“¾æ¥å‘¢, ä¸»äººä½ å¼€å¿ƒå°±å¥½ã€‚</li>
<li>poll ä»è®¾è®¡ä¸Šæ¥è¯´,ä¸å†ä¿®æ”¹ä¼ å…¥æ•°ç»„,ä¸è¿‡è¿™ä¸ªè¦çœ‹ä½ çš„å¹³å°äº†,æ‰€ä»¥è¡Œèµ°æ±Ÿæ¹–,è¿˜æ˜¯å°å¿ƒä¸º
å¦™.</li>
</ul>
<p><strong>å…¶å®æ‹–14å¹´é‚£ä¹ˆä¹…ä¹Ÿä¸æ˜¯æ•ˆç‡é—®é¢˜, è€Œæ˜¯é‚£ä¸ªæ—¶ä»£çš„ç¡¬ä»¶å®åœ¨å¤ªå¼±,ä¸€å°æœåŠ¡å™¨å¤„ç†1åƒå¤šä¸ªé“¾æ¥
ç®€ç›´å°±æ˜¯ç¥ä¸€æ ·çš„å­˜åœ¨äº†,selectå¾ˆé•¿æ®µæ—¶é—´å·²ç»æ»¡è¶³éœ€æ±‚ã€‚</strong></p>
<hr>
<p>äºæ˜¯5å¹´ä»¥å, åœ¨2002, å¤§ç¥ Davide Libenzi å®ç°äº†epoll.</p>
<p>epoll å¯ä»¥è¯´æ˜¯I/O å¤šè·¯å¤ç”¨æœ€æ–°çš„ä¸€ä¸ªå®ç°,epoll ä¿®å¤äº†poll å’Œselectç»å¤§éƒ¨åˆ†é—®é¢˜, æ¯”å¦‚:</p>
<ul>
<li>epoll ç°åœ¨æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</li>
<li>epoll ç°åœ¨ä¸ä»…å‘Šè¯‰ä½ sockç»„é‡Œé¢æ•°æ®,è¿˜ä¼šå‘Šè¯‰ä½ å…·ä½“å“ªä¸ªsockæœ‰æ•°æ®,ä½ ä¸ç”¨è‡ªå·±å»æ‰¾äº†ã€‚</li>
</ul>
<p>å¯æ˜¯epoll æœ‰ä¸ªè‡´å‘½çš„ç¼ºç‚¹ã€‚ã€‚åªæœ‰linuxæ”¯æŒã€‚æ¯”å¦‚BSDä¸Šé¢å¯¹åº”çš„å®ç°æ˜¯kqueueã€‚</p>
<p>å…¶å®æœ‰äº›å›½å†…çŸ¥åå‚å•†æŠŠepollä»å®‰å“é‡Œé¢è£æ‰è¿™ç§è„‘æ®‹çš„äº‹æƒ…æˆ‘ä¼šä¸»åŠ¨å‘Šè¯‰ä½ å˜›ã€‚ä»€ä¹ˆ,ä½ è¯´æ²¡äºº
ç”¨å®‰å“åšæœåŠ¡å™¨,å°¼ç›ä½ æ˜¯çœ‹ä¸èµ·p2pè½¯ä»¶äº†å•¦ã€‚</p>
<p>è€Œngnix çš„è®¾è®¡åŸåˆ™é‡Œé¢, å®ƒä¼šä½¿ç”¨ç›®æ ‡å¹³å°ä¸Šé¢æœ€é«˜æ•ˆçš„I/Oå¤šè·¯å¤ç”¨æ¨¡å‹å’¯,æ‰€ä»¥æ‰ä¼šæœ‰è¿™ä¸ª
è®¾ç½®ã€‚ä¸€èˆ¬æƒ…å†µä¸‹,å¦‚æœå¯èƒ½çš„è¯,å°½é‡éƒ½ç”¨epoll/kqueueå§ã€‚</p>

</content>
<p>
  
  <a href="https://sdttttt.github.io/tags/unix/">#unix</a>
  
</p>

  </main>
  <footer>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.0/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1.7.0/dist/gitalk.min.js"></script>

<div id="gitalk-container"></div>

<script>
    var gitalk = new Gitalk({
  clientID: '747ab8530477531c3d25',
  clientSecret: 'af2cc18e4c27998636a6a3c82af0064f38574170',
  repo: 'sdttttt.github.io',
  owner: 'sdttttt',
  admin: ['sdttttt'],
  id: location.pathname,      
  distractionFreeMode: true  
})

gitalk.render('gitalk-container')
</script>

</footer>

    
</body>

</html>
